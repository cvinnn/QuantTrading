

Optimal trading with a trailing stop
## Tim Leung
## âˆ—
## Hongzhong Zhang
## â€ 
## February 18, 2019
## Abstract
Trailing stop is a popular stop-loss trading strategy by which the investor will sell the asset once its
price experiences a pre-specified percentage drawdown.  In this paper, we study the problem of timing
to buy and then sell an asset subject to a trailing stop.  Under a general linear diffusion framework, we
study an optimal double stopping problem with a random path-dependent maturity.  Specifically, we first
analytically solve the optimal liquidation problem with a trailing stop, and in turn derive the optimal
timing to buy the asset.  Our method of solution reduces the problem of determining the optimal trading
regions to solving the associated differential equations.  For illustration, we implement an example and
conduct a sensitivity analysis under the exponential Ornstein-Uhlenbeck model.
Keywords:trailing stop, stop loss, optimal stopping, drawdown, stochastic floor
JEL Classification:C41, C61, G11
Mathematics Subject Classification (2010):60G40, 62L15, 91G20, 91G80
## âˆ—
Department of Applied Mathematics, University of Washington, Seattle WA 98195.  E-mail:  timleung@uw.edu.
Corresponding author.
## â€ 
IEOR Department, Columbia University.  New York, NY 10027.  E-mail:  hz2244@columbia.edu.
## 1
Electronic copy available at: https://ssrn.com/abstract=2895437

## 1    Introduction
Trailing stops are a popular trade order widely used by proprietary traders and retail investors to provide
downside protection for an existing position.  In contrast to a stop-loss exit that closes a position at a fixed
price, a trailing stop is characterized by a stochastic floor that moves based on the running maximum of the
asset price.  This provides a dynamic downside protection as the stochastic floor is automatically adjusted
upward  whenever  the  asset  price  moves  to  a  new  high.   A  trailing  stop  is  triggered  when  the  prevailing
price  of  an  asset  falls  below  the  stochastic  floor.   In  essence,  it  allows  an  investor  to  specify  a  limit  on
the maximum possible loss while not limiting the maximum possible gain.  This is particularly relevant in
common trend-following strategies, and trailing stop provides an automatic trigger to exit when prices start
to trend downward due to, for example, regime switching (Dai et al., 2010).
In addition to setting a trailing stop order,  the investor can also use a limit order to sell at a certain
price target.  If the price is sufficiently high, the investor may prefer to take profit immediately, rather than
waiting further with the possibility of setting off the trailing stop.  The investorâ€™s position will be liquidated
by either order, whichever comes first.
In this paper, we investigate the mathematical problem of optimal timing to liquidate a position subject
to a trailing stop.  Mathematically,  we recognize the trailing stop as astochastic  timing  constraintin the
sense that it installs a path-dependent random maturity into the liquidation problem, rending the problem
significantly more difficult to analyze or solve.  Furthermore, the investor can decide when to establish the
position in the first place.  This leads us to also analyze the optimal timing to enter the market.  In sum,
we study an optimal double stopping problem subject to a trailing stop.  Using excursion theory of linear
diffusion, we derive the value functions using the smallest concave majorant characterization, and discuss
the effect of trailing stopping on the optimal trading strategies analytically and numerically.  Among our
results, we reduce the problem of finding the optimal timing strategies to solving an ODE problem, which
forms the basis of our numerical scheme in determining the optimal asset acquisition and liquidation regions.
In general,  a trailing stop can be defined as the first time when the asset priceXdrops belowf(
## X),
whereXis the running maximum process ofX, andfis an increasing function such thatf(x)< xfor all
xin the support ofX.  In applied probability literature, such a stopping time is related to the drawdown
process and its first passage time.  We refer to Lehoczky (1977), Zhang (2015), and Zhang and Hadjiliadis
(2012), for a partial list of studies on drawdowns under linear diffusions.  Moreover, the optimality of trailing
stops in exercising (generalized) Russian options and detecting abrupt changes can be found in Shepp and
Shiryaev (1993), Egami and Oryu (2017) and Zhang et al. (2015), respectively
Despite being commonly used by practitioners, trailing stops have been scarcely studied in the mathe-
matical finance literature.  We trace back to Glynn and Iglehart (1995), who studied the expected discounted
reward at a trailing stop under a discrete-time random walk or a geometric Brownian motion (GBM) model,
and found that it would be optimal to never use the trailing stop if the stock followed a GBM with a positive
drift.  In contrast, our study is conducted in a more general linear diffusion framework, and provides con-
crete illustrative example on how to the use of a trailing stop will affect the optimal timing to sell an asset
under the exponential Ornstein-Uhlenbeck model.  In a random walk model, Warburton and Zhang (2006)
performed a probabilistic analysis of a variant of trailing stop.  Yin et al. (2010) implemented a stochastic
approximation scheme to determine the optimal percentage trailing stop level that maximizes the expected
discounted simple return from liquidation.  The recent study by Imkeller and Rogers (2014) compared the
performance of a number of trading rules with fixed and trailing stops under an arithmetic Brownian motion
model.
## 2
Electronic copy available at: https://ssrn.com/abstract=2895437

Compared to these works, we tackle the trading problem by formulating anoptimal double stoppingwith
astochastic  timing  constraintinduced  by  the  trailing  stop,  and  we  rigorously  derive  the  optimal  trading
strategy.  Our method of solution applies to a general linear diffusion framework, and our analytical results
facilitate computation of the value function and optimal timing strategies (see Section 5).  In our optimal
liquidation problem subject to the trailing stop,  we show that it is optimal to use a limit sell order at a
sufficiently  high  price.   In  other  words,  once  the  investor  enters  the  market,  he/she  can  immediately  set
the optimal limit sell order together with the trailing stop order, and wait for either order to be executed
automatically.
The trailing stop can be viewed as a random maturity or stopping time constraint in the optimal stopping
problem, in the sense that any admissible stopping time must come before triggering the trailing stop. Related
studies by the authors include optimal stopping problems with maturities determined by an occupation time
(Rodosthenous and Zhang (2017a,b)) or by a default time (Leung and Yamazaki (2013)), and optimal mean
reversion trading with a fixed stop-loss exit (Leung and Li (2015)). In particular, part of our study (Section 3)
generalizes the analytical framework of Leung and Li (2015) to general linear diffusions, and the results from
optimal stopping subject to a fixed stop-loss exit will prove to be directly useful for solving the analogous
problem with a trailing stop.
The  remaining  of  the  paper  is  structured  as  follows.   Section  2  presents  stochastic  framework  for  our
trading problem.  In Section 3, we study an optimal trading problem with a fixed stop-loss.  Then, in Section
4,  we  study  the  optimal  stopping  problems  for  trading  with  a  trailing  stop.   To  illustrate  our  analytical
results, we consider trading under the exponential Ornstein-Uhlenbeck model, and numerically compute the
optimal acquisition and liquidation regions in Section 5.  We also provide a sensitivity analysis on the optimal
trading strategies with respect to model parameters.  Detailed proofs are collected in the Appendix.
## 2    Model Formulation
Let us consider a risky asset value processX
## Â·
## ={X
t
## }
tâ‰¥0
modeled by a linear diffusion onIâ‰¡(l,r)âŠ‚R
with the infinitesimal generator:
## L=
## 1
## 2
Ïƒ
## 2
## (x)
## âˆ‚
## 2
## âˆ‚x
## 2
## +Î¼(x)
## âˆ‚
## âˆ‚x
,âˆ€xâˆˆI,(1)
where (Î¼(Â·),Ïƒ(Â·)) is a pair of real-valued functions onIsuch that
## 1 +|Î¼(Â·)|
Ïƒ
## 2
## (Â·)
## âˆˆL
## 1
## Loc
(I)andÏƒ(x)>0,âˆ€xâˆˆI.
For any  Ì„xâˆˆI, the running maximum ofXis denoted by
## X
t
## :=  Ì„xâˆ¨sup
sâˆˆ[0,t]
## X
s
,   tâ‰¥0.
We denote the unique probability law ofX
## Â·
byP
x, Ì„x
given{X
## 0
=x,X
## 0
=  Ì„x}for anyx, Ì„xâˆˆIwithxâ‰¤ Ì„x.
The expectation associated withP
x, Ì„x
is denoted byE
x, Ì„x
.  In calculations and results where the initial value
## X
## 0
=   Ì„xis irrelevant,  we simply writeP
x
andE
x
to denote the probability law ofX
## Â·
and the associated
expectation given{X
## 0
=x}.  Throughout, we assume that the both boundariesl,rare inaccessible.
We consider an investor who holds long one unit of the risky assetX.  Our objective is to investigate the
## 3
Electronic copy available at: https://ssrn.com/abstract=2895437

## 246810
## 0.5
## 1.0
## 1.5
## 2.0
## 2.5
## 3.0
## 3.5
Figure 1:  Sample paths of the asset price (solid black), its running maximum (gray dashed), and the 30%-
drawdown floor representing the trailing stop (red dashed).
optimal trading strategy with a trailing stop. To this end, we consider the problem of optimal early liquidation
of this risky asset, given a pre-specified trailing stop mandatory liquidation order.  Specifically, we will model
liquidation  time  by  a  stopping  timeÏ„of  the  underlying  processX
## Â·
,  and  the  reward  to  be  realized  upon
liquidation byh(X
Ï„
), whereh(Â·) is a real-valued increasing function onI, such that{xâˆˆI:h(x)>0}6=âˆ….
Fix a functionf(Â·) onI, such that
f(Â·) is continuous, strictly increasing onI,
for allxâˆˆI,f(x)âˆˆI,f(x)< x.
## (2)
Then, we define thestochastic  floorbyf(
X), whereXis the running maximum ofX.  The trailing stop,
denoted byÏ
f
, is defined as the first time the asset valueXreaches the stochastic floorf(X) from above.
That is,
## 1
Ï
f
:= inf{t >0 :X
t
< f(
## X
t
## )}.(3)
Remark 2.1.We give two standard choices of the floor functionf(Â·)here.  For example, ifI=R, setting
f(x) =xâˆ’afor  somea >0gives  the  absolute  drawdown  floor,  andÏ
f
is  the  first  timeXfalls  from  its
maximumXbyaunits.  Another specification whenI=R
## +
,f(x) = (1âˆ’Î±)xfor someÎ±âˆˆ(0,1), gives the
percentage  drawdown,  andÏ
f
is  the  first  timeXfalls  from  its  maximum
Xby(100Ã—Î±)%,  as  depicted  in
Figure 1 withÎ±= 0.3.
The investor faces the following optimal stopping problem:
v
f
(x, Ì„x) :=  sup
Ï„âˆˆT
## T
f
## E
x, Ì„x
## (e
## âˆ’qÏ„
h(X
Ï„
## )1
## {Ï„<âˆ}
## ).(4)
whereq >0 is a subjective discounting rate, andT
## T
f
is the set of all stopping times ofXthat stop no later
than the trailing stopÏ
f
.  Notice thatÏ
f
puts a mandatory selling order of the risky asset, pre-specified by
the investor.
To quantify the gain in terms of expected discounted reward from liquidating earlier than the trailing
## 1
As usual, we set infâˆ…=âˆ.
## 4
Electronic copy available at: https://ssrn.com/abstract=2895437

stop timeÏ
f
, we define theearly liquidation premiumby the difference
p
f
## (x, Ì„x) :=v
f
## (x, Ì„x)âˆ’g
f
## (x, Ì„x),(5)
where the second term represents the expected discounted reward from waiting to sell at the trailing stop,
that is,
g
f
(x, Ì„x) :=E
x, Ì„x
## (e
## âˆ’qÏ
f
h(X
Ï
f
## )1
## {Ï
f
## <âˆ}
## ).(6)
As a convention, we defineâˆâˆ’âˆ=âˆif both terms on the right-hand side of  (5) are infinity.  Clearly,
we  havep
f
(x, Ì„x)â‰¥0  for  allx, Ì„xâˆˆIwithxâ‰¤ Ì„x.   For  our  study,  the  early  liquidation  premium  turns
out  to  be  amenable  to  analysis  and  give  intuitive  interpretations.   The  related  concepts  of  early/delayed
exercise/purchase  premium  have  been  analyzed  in  pricing  American  options  (see  Carr  et  al.  (1992))  and
derivatives trading (Leung and Ludkovski (2011)), among other applications.
Remark 2.2.If floor functionsf
## 1
## (Â·),f
## 2
(Â·)both satisfy(2), andf
## 1
## (x)â‰¤f
## 2
(x)for allxâˆˆI, then for every
fixedxâˆˆI, we have the inequalities:
h(x)â‰¤v
f
## 2
## (x, Ì„x)â‰¤v
f
## 1
## (x, Ì„x)â‰¤sup
Ï„âˆˆT
## E
x
## (e
## âˆ’qÏ„
h(X
Ï„
## )1
## {Ï„<âˆ}
## ),(7)
whereTis the set of all stopping times ofX.
Given the optimal valuev
f
(x, Ì„x), another related problem is
v
## (1)
f
(x) = sup
Ï„âˆˆT
## E
x
## (e
## âˆ’qÏ„
## (v
f
## (X
Ï„
## ,X
Ï„
## )âˆ’h
b
## (X
Ï„
## ))1
## {Ï„<âˆ}
## ),(8)
whereh
b
(Â·) is an increasing function onIsuch thath
b
(x)â‰¥h(x) for allxâˆˆI,
## 2
and sup
xâˆˆI
## (v
f
## (x,x)âˆ’h
b
## (x))>
0,Tis the set of all stopping times w.r.t.  the filtration generated byX.  The problem arises, for example,
in optimal acquisition of the assetXwhenh
b
## (x) =x+c
b
, wherec
b
â‰¥0 is a transaction fee.
## 3
In general, if
we assume thath
b
(X) is the price the investor need to pay to acquire one unit of the risky asset, then (8)
represents the problem of finding the optimal time to purchase this risk asset.  Note that the investor will
select the optimal time to sell but subject to a trailing stop exit.  For this reason, we will call the problem
in (8) the optimal acquisition problem with a trailing stop, even for a general rewardh
b
## (Â·).
Remark 2.3.Note that in(8), we apply the value functionv
f
(x, Ì„x) onlywithx=  Ì„x.  From a practical point
of view,  this is the most relevant case since a trailing stop should be placed based on the price at which the
asset was purchased, rather than an arbitrary reference price.
In summary, the solutions to (8) and (4) yield the optimal trading strategy that involves buying a risky
asset and selling it later while being protected by a trailing stop.
2.1    Preliminaries of Linear Diffusions
It is well known that (see, for example, (Borodin and Salminen, 2002)), for anyq >0, theSturm-Liouville
equation(Lâˆ’q)u(x) = 0 has a positive increasing solutionÏ†
## +
q
(Â·) and a positive decreasing solutionÏ†
## âˆ’
q
## (Â·).
## 2
If there is anxâˆˆIsuch thath
b
(x)< h(x), then immediate selling after purchasing when the asset price is atxyields a
strictly positive profit with certainty, hence an arbitrage.
## 3
In this case,h(x) =xâˆ’c
s
wherec
s
â‰¥0 is a transaction fee.
## 5
Electronic copy available at: https://ssrn.com/abstract=2895437

In fact, for an arbitrary fixedÎºâˆˆI, the solutions can be expressed as
Ï†
## +
q
## (x) =
## ï£±
## ï£´
## ï£²
## ï£´
## ï£³
## E
x
## (e
## âˆ’qÏ„
## +
## X
## (Îº)
## ),ifxâ‰¤Îº
## 1
## E
Îº
## (e
## âˆ’qÏ„
## +
## X
## (x)
## )
,ifx > Îº
, Ï†
## âˆ’
q
## (x) =
## ï£±
## ï£´
## ï£²
## ï£´
## ï£³
## 1
## E
Îº
## (e
## âˆ’qÏ„
## âˆ’
## X
## (x)
## )
## ,ifxâ‰¤Îº
## E
x
## (e
## âˆ’qÏ„
## âˆ’
## X
## (Îº)
),ifx > Îº
## ,(9)
whereÏ„
## +
## X
(y) andÏ„
## âˆ’
## X
(y) are the first passage times ofXto levelyâˆˆIfrom below and above, respectively,
Ï„
## Â±
## X
(y) := inf{t >0 :X
t
â‰·y},âˆ€yâˆˆI.(10)
The functionsÏ†
## Â±
q
(Â·) are also closely related to two-sided exit problems ofX.  Specifically, we have:
Lemma 2.1.Lehoczky (1977) Suppose thatl < yâ‰¤xâ‰¤z < r, then forq >0, we have
## E
x
## (e
## âˆ’qÏ„
## âˆ’
## X
## (y)
## 1
## {Ï„
## âˆ’
## X
## (y)<Ï„
## +
## X
## (z)}
## ) =
Ï†
## âˆ’
q
## (x)
Ï†
## âˆ’
q
## (y)
Ïˆ
q
## (z)âˆ’Ïˆ
q
## (x)
Ïˆ
q
## (z)âˆ’Ïˆ
q
## (y)
## ,
## E
x
## (e
## âˆ’qÏ„
## +
## X
## (z)
## 1
## {Ï„
## âˆ’
## X
## (y)>Ï„
## +
## X
## (z)}
## ) =
Ï†
## âˆ’
q
## (x)
Ï†
## âˆ’
q
## (z)
Ïˆ
q
## (x)âˆ’Ïˆ
q
## (y)
Ïˆ
q
## (z)âˆ’Ïˆ
q
## (y)
## ,
whereÏˆ
q
## :I7â†’R
## +
is a strictly increasing function defined as
Ïˆ
q
## (x) :=
Ï†
## +
q
## (x)
Ï†
## âˆ’
q
## (x)
,âˆ€xâˆˆI.(11)
Remark 2.4.By the boundary behavior ofX, we haveÏ†
## âˆ’
q
## (l+) =Ï†
## +
q
(râˆ’) =âˆ, henceÏˆ
q
(I) = (0,âˆ).  See
(Borodin and Salminen, 2002, p.  18-19) for more details.
2.2    Standing Assumption and its Implications
We now discuss the following standing assumption on the reward functionh(Â·).
Assumption 2.1.The  reward  functionh(Â·)is  increasing,  twice  differentiable  onI,  and  there  is  anx
## 0
in
the interior ofIsuch that
(Lâˆ’q)h(x)â‰¥0if and only ifxâ‰¤x
## 0
## .(12)
Moreover, we have
lim
xâ†’r
h(x)
Ï†
## +
q
## (x)
## <sup
x>x
## 0
h(x)
Ï†
## +
q
## (x)
## <âˆ,(13)
Remark 2.5.By  (Dayanik  and  Karatzas,  2003,  Proposition  5.10),  it  is  easily  seen  that  Assumption  2.1
ensures  the  finiteness  of  the  upper  bound  in(7)for  allxâˆˆI.   Moreover,  the  assumption  implies  that  the
optimal stopping time for the upper bound is of threshold type, as proved in the following lemma.
Lemma 2.2.Under Assumption 2.1, there is anx
## ?
## âˆˆ[x
## 0
,r)such that,
sup
Ï„âˆˆT
## E
x
## (e
## âˆ’rÏ„
h(X
Ï„
## )1
## {Ï„<âˆ}
## ) =E
x
## (e
## âˆ’rÏ„
## +
## X
## (x
## ?
## )
h(X
Ï„
## +
## X
## (x
## ?
## )
## )1
## {Ï„
## +
## X
## (x
## ?
## )<âˆ}
## ).
Lemma 2.2 shows that Assumption 2.1 is sufficient for the optimality of upcrossing strategyT
## +
x
## ?
in optimal
stopping problem sup
Ï„âˆˆT
## E
x
## (e
## âˆ’rÏ„
h(X
Ï„
## )1
## {Ï„<âˆ}
), wherex
## ?
is a constant in (x
## 0
,r).  Sinceh(X
Ï„
) represents
the proceeds from selling the risky asset, the economic insight of Lemma 2.2 is that, under no constraint (i.e.
## 6
Electronic copy available at: https://ssrn.com/abstract=2895437

no trailing stop), it is optimal to sell the asset when its price is sufficiently high.  Thus, apart from analytical
tractability considerations, Assumption 2.1 is also economically reasonable for our trading problem.
Remark 2.6.We  give  a  few  examples  in  which  Assumption  2.1  holds.  First,  leth(x) =xâˆ’Kfor  some
constantK >0,  andX
## Â·
be  the  Black-Scholes  model,  i.e.Î¼(x)  =Î¼x,Ïƒ(x)  =Ïƒxfor  allxâˆˆI=R
## +
## ,
with  constantsÎ¼ < q,Ïƒ >0.
## 4
Second,  we  can  leth(x) =xandX
## Â·
be  the  Ornstein-Uhlenbeck  process,  i.e.
Î¼(x) =Î»(Î¸âˆ’x)andÏƒ(x) =ÏƒforxâˆˆI=R, with constantsÎ»,Ïƒ >0andÎ¸âˆˆR.
3    Optimal Trading with a Fixed Stop-Loss
To gain some intuition for our solution method for the problem in (4) with a trailing stop, we first consider the
optimal stopping problems when the investor uses a fixed stop-loss exit instead of a trailing stop.  Precisely,
arbitrarily fix ayâˆˆI, we consider the following class of problems indexed byy:
## V
y
(x) := sup
Ï„âˆˆT
## S
y
## E
x
## (e
## âˆ’qÏ„
h(X
Ï„
## )1
## {Ï„<âˆ}
## ),(14)
whereT
## S
y
is the set of all stopping times ofXthat stops no later than the first passage time to levely, i.e.
Ï„
## âˆ’
## X
(y) = inf{t >0 :X
t
< y},(15)
andcâˆˆ[0,sup
xâˆˆI
## (V
y
(x)âˆ’h(x)))  is  a  transaction  fee  for  asset  acquisition.   The  problem  in  (14)  puts  a
mandatory liquidation constraint upon hitting the fixed stop-loss levelyfrom above.
The special cases of the problem in (14) with the reward functionh(x) =xâˆ’cdriven by the OU and
CIR processes have been studied in Cartea et al. (2015); Leung and Li (2015); Leung et al. (2014, 2015).  In
this section, we present the analysis of problem (14) driven by a general linear diffusion.
3.1    Optimal Liquidation Subject to a Stop-loss Exit
We now study the optimal liquidation problem (14) whereXfollows a general linear diffusion (see (1)).  To
facilitate our analysis, we also consider the extended case of (14) fory=l, in which case we have
## V
l
(x) = sup
Ï„âˆˆT
## E
x
## (e
## âˆ’qÏ„
h(X
Ï„
## )1
## {Ï„<âˆ}
## ).(16)
Notice that the value functionV
l
(Â·) has already been derived in Lemma 2.2.
Remark 3.1.For each fixedxâˆˆI, the mappingy7â†’V
y
(x)is obviously non-increasing over[l,r).
Remark  3.2.The  connection  between(4)and(14)can  be  seen  as  follows.   For  anyx, Ì„xâˆˆIsuch  that
xâˆˆ(f( Ì„x), Ì„x],  by  theP
x, Ì„x
-a.s.  inequality  thatÏ
f
## â‰¤Ï„
## âˆ’
## X
(f( Ì„x)),  we  know  thatT
## T
f
## âŠ‚ T
## S
f( Ì„x)
## .  Hence,v
f
## (x, Ì„x)â‰¤
## V
f( Ì„x)
(x).  As a consequence, if we define the optimal liquidation regions
## S
## T,L
f
## ( Ì„x) :={xâˆˆ(l, Ì„x] :v
f
(x, Ì„x) =h(x)},âˆ€ Ì„xâˆˆI,(17)
## S
## S,L
y
:={xâˆˆI:V
y
(x) =h(x)},âˆ€yâˆˆI,(18)
## 4
It is well-known that ifÎ¼â‰¥q, then the optimal stopping region is the empty set.
## 7
Electronic copy available at: https://ssrn.com/abstract=2895437

then we have
## (
## S
## S,L
f( Ì„x)
## âˆ©(l, Ì„x]
## )
## âŠ‚S
## T,L
f
## ( Ì„x),âˆ€ Ì„x >0.
Additionally, if Ì„xâˆˆS
## S,L
f( Ì„x)
then we have
## (
## S
## S,L
f( Ì„x)
## âˆ©(l, Ì„x]
## )
## =S
## T,L
f
( Ì„x), since in this case it is optimal to liquidate
beforeXreaching a new maximum.
Proposition 3.1.Under Assumption 2.1, for any fixedyâˆˆ(l,x
## 0
), there is a finite thresholdb(y)âˆˆ(x
## 0
## ,r)
such that
## 5
## V
y
(x) =E
x
## (e
## âˆ’q(Ï„
## +
## X
## (b(y))âˆ§Ï„
## âˆ’
## X
## (y))
h(X
Ï„
## +
## X
## (b(y))âˆ§Ï„
## âˆ’
## X
## (y)
)),âˆ€xâˆˆI.(19)
Hereb(y)can be identified as the smallest solution over(x
## 0
## ,r)to
h
## â€²
## (b)âˆ’h(b)
Ï†
## âˆ’,â€²
q
## (b)
Ï†
## âˆ’
q
## (b)
## =
Ï†
## âˆ’
q
## (b)Ïˆ
## â€²
q
## (b)
Ïˆ
q
## (b)âˆ’Ïˆ
q
## (y)
## (
h(b)
Ï†
## âˆ’
q
## (b)
## âˆ’
h(y)
Ï†
## âˆ’
q
## (y)
## )
## .(20)
Moreover, the mappingy:7â†’b(y)is strictly decreasing and differentiable over(l,x
## 0
), with limitsb(x
## 0
## âˆ’) =x
## 0
## ,
andb(l+)â‰¤x
## âˆ—
< r, wherex
## âˆ—
is defined in Lemma 2.2.
Corollary 3.1.Ifyâˆˆ[x
## 0
,r), then the stopping regionS
## S,L
y
=I, i.e.  there is no continuation region.
4    Optimal Trading with a Trailing Stop
In this section, we apply the results we obtained to study the optimal liquidation problem (4) and the optimal
acquisition problem (8).
## 4.1    Optimal Liquidation
Returning to the problem in (4), we will first using results in Theorem 3.1 to construct a candidate threshold
type strategy for liquidation before the trailing stopÏ
f
## .
Corollary 4.1.There is a uniqueb
## ?
f
## â‰¥x
## 0
such thatb(f( Ì„x))> Ì„xif and only if Ì„x < b
## ?
f
## .  Moreover,b
## ?
f
can be
identified as the unique solution over(x
## 0
## ,f
## âˆ’1
## (x
## 0
))toÎ“( Ì„x) = 0, where
## Î“( Ì„x) :=
## 1
Ïˆ
## â€²
q
## ( Ì„x)
## (
h
## â€²
## ( Ì„x)
Ï†
## âˆ’
q
## ( Ì„x)
## âˆ’
h( Ì„x)Ï†
## âˆ’,â€²
q
## ( Ì„x)
## (Ï†
## âˆ’
q
## ( Ì„x))
## 2
## )
## âˆ’
## 1
Ïˆ
q
## ( Ì„x)âˆ’Ïˆ
q
## (f( Ì„x))
## (
h( Ì„x)
Ï†
## âˆ’
q
## ( Ì„x)
## âˆ’
h(f( Ì„x))
Ï†
## âˆ’
q
## (f( Ì„x))
## )
## .(21)
Moreover,Î“( Ì„x)>0ifl < Ì„x < b
## ?
f
, andÎ“( Ì„x)<0iff
## âˆ’1
## (x
## 0
)> Ì„x > b
## ?
f
## .
Remark  4.1.We  briefly  explain  the  rationale  behind  the  characterization  ofb
## ?
f
in  Corollary  4.1  here.
Instead  of  solving  the  stopping  problem  with  a  trailing  stop(4)optimally,  let  us  consider  a  sub-optimal,
myopic  strategy.   The  strategy  that  will  be  considered  is  the  optimal  strategy  given  in  Theorem  3.1  when
y=f(
x),  wherexis  the  initial  level  of  the  running  maximum.   We  call  this  strategy  myopic  because  the
strategy is obtained by fixing a stop-loss level, instead of allowing the stop level moving along with the running
maximum.   Typically,  it  is  impossible  to  attain  the  optimal  myopic  stopping  threshold  without  establishing
a  new  high  for  the  running  maximum,  unless  the  initial  maximum  level  is  already  sufficiently  high.   The
## 5
Notice that in the expectation (19) we donâ€™t have the indicator1
## {Ï„
## +
## X
## (b(y))âˆ§Ï„
## âˆ’
## X
## (y)<âˆ}
, as it is equal to 1 almost surely.
## 8
Electronic copy available at: https://ssrn.com/abstract=2895437

thresholdb
## ?
f
is the critical level beyond which, the above myopic strategy becomes optimal.  In fact, when the
initial running maximum
x=b
## ?
f
, the optimal stopping threshold for the fixed stop-loss level aty=f(b
## ?
f
## )is
exactly atb
## ?
f
.  Hence,(21)is obtained by imposing(20)to hold whenb=xandy=f(x).
Let us suppose for now that  Ì„xâ‰¥b
## ?
f
## .  Then,
-  If we still havef( Ì„x)< x
## 0
, then by the definition ofb
## ?
f
given in Corollary 4.1, we haveb(f( Ì„x))â‰¤ Ì„x.
Thus, by Remark 3.2,
h(x)â‰¤v
f
(x, Ì„x)â‰¤V
f( Ì„x)
(x),âˆ€x, Ì„xâˆˆIwithxâ‰¤ Ì„x,
## ((l,f( Ì„x)]âˆ©[b(f( Ì„x)), Ì„x])â‰¡
## (
## S
## S,L
f( Ì„x)
## âˆª(l, Ì„x]
## )
## =S
## T,L
f
## ( Ì„x).
## 2.  Iff( Ì„x)â‰¥x
## 0
, then by Corollary 3.1, we can use the same argument as above to conclude that (l, Ì„x]â‰¡
## (
## S
## S,L
f( Ì„x)
## âˆ©(l, Ì„x]
## )
## =S
## T,L
f
## ( Ì„x).
As a consequence we obtain the following theorem:
Theorem 4.1.Under Assumption 2.1, forx, Ì„xâˆˆIwithxâ‰¤ Ì„xand Ì„xâ‰¥b
## ?
f
, we have
v
f
(x, Ì„x)â‰¡V
f( Ì„x)
## (x).
So the optimal stopping time isÏ
f
## âˆ§Ï„
## +
## X
## (b(f( Ì„x))).
In what follows we consider the remaining casel < xâ‰¤ Ì„x < b
## ?
f
and we shall establish the optimality of
the stopping ruleÏ„
## +
## X
## (b
## ?
f
## )âˆ§Ï
f
.  To this end, we first calculate the associated value of this strategy, denoted
byu
f
(x, Ì„x).   In  particular,  by  the  strong  Markov  property  ofX,  applying  Lemma  2.1  we  have  for  any
xâˆˆ(f( Ì„x), Ì„x) with  Ì„x < b
## ?
f
## ,
u
f
(x, Ì„x) :=E
x, Ì„x
## (e
## âˆ’r(Ï
f
## âˆ§Ï„
## +
## X
## (b
## ?
f
## ))
h(X
Ï
f
## âˆ§Ï„
## +
## X
## (b
## ?
f
## ))
## ))
=h(f( Ì„x))E
x
## (e
## âˆ’qÏ„
## âˆ’
## X
## (f( Ì„x))
## 1
## {Ï„
## âˆ’
## X
## (f( Ì„x))<Ï„
## +
## X
## ( Ì„x)}
## ) +u
f
( Ì„x, Ì„x)E
x
## (e
## âˆ’qÏ„
## +
## X
## ( Ì„x)
## 1
## {Ï„
## +
## X
## ( Ì„x)<Ï„
## âˆ’
## X
## (f( Ì„x))}
## )
## =Ï†
## âˆ’
q
## (x)
## (
h(f( Ì„x))
Ï†
## âˆ’
q
## (f( Ì„x))
Ïˆ
q
## ( Ì„x)âˆ’Ïˆ
q
## (x)
Ïˆ
q
## ( Ì„x)âˆ’Ïˆ
q
## (f( Ì„x))
## +
u
f
## ( Ì„x, Ì„x)
Ï†
## âˆ’
q
## ( Ì„x)
Ïˆ
q
## (x)âˆ’Ïˆ
q
## (f( Ì„x))
Ïˆ
q
## ( Ì„x)âˆ’Ïˆ
q
## (f( Ì„x))
## )
## ,(22)
where for  Ì„x < b
## ?
f
, we have
u
f
## ( Ì„x, Ì„x)
Ï†
## âˆ’
q
## ( Ì„x)
## =
h(b
## ?
f
## )
Ï†
## âˆ’
q
## ( Ì„x)
## E
## Ì„x, Ì„x
## (e
## âˆ’qÏ„
## +
## X
## (b
## ?
f
## )
## 1
## {Ï„
## +
## X
## (b
## ?
f
## )<Ï
f
## }
## ) +
## 1
Ï†
## âˆ’
q
## ( Ì„x)
## E
## Ì„x, Ì„x
## (e
## âˆ’qÏ
f
h(X
Ï
f
## )1
## {Ï
f
## <Ï„
## +
## X
## (b
## ?
f
## )}
## ).(23)
The two expectations in (23) can be computed using standard calculation using excursion theory:
Lemma 4.1.For anyb > Ì„x, we have
## E
## Ì„x, Ì„x
## (e
## âˆ’qÏ
f
h(X
Ï
f
## )1
## {Ï
f
## <Ï„
## +
## X
## (b)}
## ) =Ï†
## âˆ’
q
## ( Ì„x)
## âˆ«
b
## Ì„x
h(f(v))
Ï†
## âˆ’
q
## (f(v))
Ïˆ
## â€²
q
## (v)
Ïˆ
q
## (v)âˆ’Ïˆ
q
## (f(v))
exp(âˆ’
## âˆ«
v
## Ì„x
Ïˆ
## â€²
q
(u) du
Ïˆ
q
## (u)âˆ’Ïˆ
q
## (f(u))
## )dv,
and
## E
## Ì„x, Ì„x
## (e
## âˆ’qÏ„
## +
## X
## (b)
## 1
## {Ï„
## +
## X
## (b)<Ï
f
## }
## ) =
Ï†
## âˆ’
q
## ( Ì„x)
Ï†
## âˆ’
q
## (b)
exp(âˆ’
## âˆ«
b
## Ì„x
Ïˆ
## â€²
q
## (u)du
Ïˆ
q
## (u)âˆ’Ïˆ
q
## (f(u))
## ).
## 9
Electronic copy available at: https://ssrn.com/abstract=2895437

In particular, asbâ†’rwe obtain the value of the plain trailing stop (defined in(6))
g
f
## ( Ì„x, Ì„x) =Ï†
## âˆ’
q
## ( Ì„x)
## âˆ«
r
## Ì„x
h(f(v))
Ï†
## âˆ’
q
## (f(v))
Ïˆ
## â€²
q
## (v)
Ïˆ
q
## (v)âˆ’Ïˆ
q
## (f(v))
exp(âˆ’
## âˆ«
v
## Ì„x
Ïˆ
## â€²
q
(u) du
Ïˆ
q
## (u)âˆ’Ïˆ
q
## (f(u))
## )dv,
and forf( Ì„x)< xâ‰¤ Ì„x,
g
f
## (x, Ì„x) =Ï†
## âˆ’
q
## (x)
## (
## (hf( Ì„x))
Ï†
## âˆ’
q
## (f( Ì„x))
Ïˆ
q
## ( Ì„x)âˆ’Ïˆ
q
## (x)
Ïˆ
q
## ( Ì„x)âˆ’Ïˆ
q
## (f( Ì„x))
## +
g
f
## ( Ì„x, Ì„x)
Ï†
## âˆ’
q
## ( Ì„x)
Ïˆ
q
## (x)âˆ’Ïˆ
q
## (f( Ì„x))
Ïˆ
q
## ( Ì„x)âˆ’Ïˆ
q
## (f( Ì„x))
## )
## .
To establish the optimality ofÏ„
## +
## X
## (b
## ?
f
## )âˆ§Ï
f
when 0< xâ‰¤ Ì„x < b
## ?
f
, we need to show that the value of the
ruleu
f
(x, Ì„x) dominates the reward functionh(x).  This claim can be proved by using (22) and the optimality
ofb
## ?
f
## (see Corollary 4.1).
Lemma 4.2.For all Ì„xâˆˆ(l,b
## ?
f
)andxâˆˆ(f( Ì„x), Ì„x], we haveu
f
(x, Ì„x)> h( Ì„x).
Lemma 4.2 says that waiting untilÏ„
## +
## X
## (b
## ?
f
## )âˆ§Ï
f
yields positive â€œtime valueâ€u
f
(x, Ì„x)âˆ’h(x)>0 for all
f( Ì„x)< xâ‰¤ Ì„x < b
## ?
f
,  so this region should be part of the optimal continuation region.  On the one hand,
before hittingb
## ?
f
,  this region is obviously the maximum possible continuation region.  Furthermore,  upon
hittingb
## ?
f
we have  Ì„x=b
## ?
f
, and the case has already been treated in Theorem 4.1, which suggest immediate
stopping atÏ„
## +
## X
## (b
## ?
f
).  So we know that the stopping timeÏ„
## +
## X
## (b
## ?
f
## )âˆ§Ï
f
is optimal for problem (4) if  Ì„x < b
## ?
f
## .
Theorem 4.2.Under Assumption 2.1, we have for alll < xâ‰¤ Ì„x < b
## ?
f
that,
v
f
## (x, Ì„x)â‰¡u
f
(x, Ì„x) =E
x, Ì„x
## (e
## âˆ’q(Ï„
## +
## X
## (b
## ?
f
## )âˆ§Ï
f
## )
)h(X
Ï„
## +
## X
## (b
## ?
f
## )âˆ§Ï
f
## ),
whereb
## ?
f
is  defined  in  Corollary  4.1.   Moreover,  the  mappingf7â†’b
## ?
f
is  non-increasing  over  all  functions
satisfying(2).
Proof.The only claim that needs a proof is the monotonicity off7â†’b
## ?
f
.  But that is due to Remark 2.2 and
the structure of the optimal stopping region.
Corollary 4.2.The value of the plain trailing stopg
f
(x, Ì„x)given in Lemma 4.1 is finite.  Moreover, for any
f( Ì„x)< xâ‰¤ Ì„x < b
## ?
f
, the early liquidation premium given the trailing stopÏ
f
is given by
p
f
## (x, Ì„x) =
Ï†
## âˆ’
q
## (x)
Ï†
## âˆ’
q
## (b
## ?
f
## )
Ïˆ
q
## (x)âˆ’Ïˆ
q
## (f( Ì„x))
Ïˆ
q
## ( Ì„x)âˆ’Ïˆ
q
## (f( Ì„x))
exp(
## âˆ«
b
## ?
f
## Ì„x
## âˆ’Ïˆ
## â€²
q
## (u)du
Ïˆ
q
## (u)âˆ’Ïˆ
q
## (f(u))
## )
## (
h(b
## ?
f
## )âˆ’g
f
## (b
## ?
f
## ,b
## ?
f
## )
## )
## ,
whereg
f
## (b
## ?
f
## ,b
## ?
f
)is given in Lemma 4.1.  Iff( Ì„x)< x
## 0
## , Ì„xâ‰¥b
## ?
f
andf( Ì„x)< x < b(f( Ì„x))(see Proposition 3.1
for the existence ofb(y)), then the early liquidation premium given the trailing stopÏ
f
is
p
f
## (x, Ì„x) =
Ï†
## âˆ’
q
## (x)
Ï†
## âˆ’
q
## (b(f( Ì„x)))
Ïˆ
q
## (x)âˆ’Ïˆ
q
## (f( Ì„x))
Ïˆ(b(f( Ì„x)))âˆ’Ïˆ
q
## (f( Ì„x))
## (h(b(f( Ì„x)))âˆ’g
f
## (b(f( Ì„x)), Ì„x)).
Finally, iff( Ì„x)< x
## 0
## , Ì„xâ‰¥b
## ?
f
andb(f( Ì„x))â‰¤xâ‰¤ Ì„x, orf( Ì„x)â‰¥x
## 0
andf( Ì„x)< xâ‰¤ Ì„x, then the early liquidation
premium given the trailing stopÏ
f
is
p
f
## (x, Ì„x) =h(x)âˆ’g
f
## (x, Ì„x).
## 10
Electronic copy available at: https://ssrn.com/abstract=2895437

Remark  4.2.If  the  first  inequality  in(13)is  an  equality,  then  the  optimal  thresholdb
## ?
f
may  be  at  the
boundaryr,  in  which  case,  it  will  be  optimal  not  to  liquidate  before  the  trailing  stop.  That  is,p
f
## (x, Ì„x) = 0
for allx, Ì„xâˆˆIsuch thatxâˆˆ(f( Ì„x), Ì„x].
4.2    Optimal Acquisition with a Trailing Stop
In this section, we solve the optimal stopping problem related to acquisition with a trailing stop, which we
recall as follows:
v
## (1)
f
(x) = sup
Ï„âˆˆT
## E
x
## (e
## âˆ’qÏ„
## (v
f
## (X
Ï„
## ,X
Ï„
## )âˆ’h
b
## (X
Ï„
## ))1
## {Ï„<âˆ}
## ),(24)
whereTis the set of all stopping times ofX, and sup
xâˆˆI
## (v
f
## (x,x)âˆ’h
b
## (x))>0.
Let us define the optimal acquisition region with a trailing stop as
## S
## T,A
f
:={xâˆˆI:v
## (1)
f
## (x) =v
f
## (x,x)âˆ’h
b
## (x)}.
Following (Dayanik and Karatzas, 2003, Proposition 5.10) and (23), to determineS
## T,A
f
, it suffices to obtain
the smallest concave majorant of
## H
## (1)
## (z) :=
v
f
## (x,x)âˆ’h
b
## (x)
Ï†
## âˆ’
q
## (x)
## ,wherez=Ïˆ
q
(x)âˆˆR
## +
,xâˆˆI.(25)
In light of Theorem 4.1, we know that forxâ‰¥b
## ?
f
, we havev
f
## (x,x)âˆ’h
b
## (x) =h(x)âˆ’h
b
(x)â‰¤0, so we must
haveS
## T,A
f
âŠ‚I\[b
## ?
f
## ,r) = (l,b
## ?
f
).  Therefore, if we denote by
z
## ?
f
:= sup arg max
zâˆˆR
## +
## H
## (1)
## (z).(26)
Then we haveH
## (1)
## (
z
## ?
f
)>0 (since  sup
x>0
## (v
f
## (x,x)âˆ’h
b
(x))>0),  andz
## ?
f
## âˆˆ[0,Ïˆ
q
## (b
## ?
f
)),  and  the smallest
concave majorant ofH
## (1)
(Â·) over [z
## ?
f
,âˆ) must be given by the constant functionH
## (1)
## (z
## ?
f
), so we can deduce
thatS
## T,A
f
## âŠ‚(l,Ïˆ
## âˆ’1
q
## (z
## ?
f
)].  However, no further information aboutS
## T,A
f
is available under general diffusions,
mainly  due  to  lack  of  information  about  the  concavity  ofH
## (1)
(Â·).   In  fact,  as  seen  in  Lemma  4.3  below,
even  in  the  special  caseh
b
(Â·)â‰¡h(Â·),  functionH
## (1)
(Â·)  over  (0,Ïˆ
q
## (b
## ?
f
))  is  the  difference  between  a  convex
functionH
f
(Â·) over (0,Ïˆ
q
## (b
## ?
f
)) and a functionH(Â·) that is convex over (0,Ïˆ
q
## (x
## 0
)) and is strictly concave
over (Ïˆ
q
## (x
## 0
## ),Ïˆ
q
## (b
## ?
f
)), so we only know thatH
## (1)
(Â·) is convex on (Ïˆ
q
## (x
## 0
## ),Ïˆ
q
## (b
## ?
f
)), but the concavity of this
function over (0,Ïˆ
q
## (x
## 0
)) is not available to us.
Lemma 4.3.Consider function
## H
f
## (z) :=
v
f
## (x,x)
Ï†
## âˆ’
q
## (x)
## ,  H(z) :=
h(x)
Ï†
## âˆ’
q
## (x)
## ,wherez=Ïˆ
q
(x)âˆˆR
## +
## .(27)
ThenH
f
(Â·)is convex on(0,Ïˆ
q
## (b
## ?
f
)), andH(Â·)is strictly concave on(Ïˆ
q
## (x
## 0
),âˆ)and is convex on(0,Ïˆ
q
## (x
## 0
## )).
Remark 4.3.IfXfollows the Black-Scholes model with driftÎ¼ < q, and volatilityÏƒ >0, then as in Leung
et al. (2015), it is never optimal to acquire the stock givenh(x) =xâˆ’c
s
andh
b
## (x) =x+c
b
, with transaction
feesc
s
## >0andc
b
â‰¥0.  To see this, we recall thatv
f
## (x,x)< V
## 0
## (x) =1
## {x<b}
## (
x
b
## )
Î²
## +
## (bâˆ’c
s
## ) +1
## {xâ‰¥b}
## (xâˆ’c
s
## ),
whereÎ²
## +
## =Î´+
## âˆš
Î´
## 2
## +
## 2q
Ïƒ
## 2
## >1withÎ´=
Î¼
Ïƒ
## 2
## âˆ’
## 1
## 2
,  andb=
Î²c
s
Î²âˆ’1
.   The  convexity  ofV
## 0
(Â·)implies  that
## V
## 0
(x)âˆ’h(x)< c
s
for  allxâˆˆR
## +
,  sov
f
(x,x)âˆ’h(x)< c
s
for  allxâˆˆR
## +
,  for  any  floor  functionf(Â·)that
## 11
Electronic copy available at: https://ssrn.com/abstract=2895437

satisfies(2).  Thus, we havev
f
## (x,x)âˆ’h
b
## (x) =v
f
## (x,x)âˆ’h(x)âˆ’(c
b
## +c
s
## )<âˆ’c
b
â‰¤0, so the payoff function
for problem(24)to be negative throughoutR
## +
,  yielding an empty optimal stopping region.  For some other
forms ofh(Â·), one may obtain a non-empty stopping region for problem(24)(see Example 4.1 below).
Example 4.1.Assuming thatÎ¼(x) =Î¼x,Ïƒ(x) =Ïƒx,h(x) =h
b
(x) =xâˆ’Kx
## âˆ’
for allxâˆˆIâ‰¡R
## +
,  where
Î¼âˆˆRsuch thatÎ¼ < q, andÏƒ,K >0andâ‰¥0such that
## 1
## 2
Ïƒ
## 2
## (+ 1)âˆ’Î¼âˆ’q <0.  Letf(x) = (1âˆ’Î±)xfor
someÎ±âˆˆ(0,1).  Then  we  haveS
## T,A
f
## = (0,b
## ?
f
],  whereb
## ?
f
## :=Ïˆ
## âˆ’1
q
## (z
## ?
f
## )withz
## ?
f
given  in(26),  or  equivalently,
withz
## ?
f
as the unique root to(50)in the Appendix.  That is, for allxâˆˆI
v
## (1)
f
(x) =E
x
## (e
## âˆ’qÏ„
## âˆ’
## X
## (b
## ?
f
## )
## (v
f
## (X
Ï„
## âˆ’
## X
## (b
## ?
f
## )
## ,X
Ï„
## âˆ’
## X
## (b
## ?
f
## )
## )âˆ’h
b
## (X
Ï„
## âˆ’
## X
## (b
## ?
f
## )
## ))1
## {Ï„
## âˆ’
## X
## (b
## ?
f
## )<âˆ}
## ).
In general, one can analyze the concavity ofH
## (1)
(Â·) (and hence the optimal stopping region) on a case-
by-case basis with possibly helps of numerical computation.  To demonstrate the idea, let us define
z
## ?
f
## :=Ïˆ
q
## (b
## ?
f
),  Ï†(z) :=Ïˆ
q
## (f(Ïˆ
## âˆ’1
q
(z))),âˆ€zâˆˆR
## +
## .(28)
It  is  clear  thatÏ†(Â·)  is  an  increasing  function  such  that  0< Ï†(z)< z.   From  Lemma  4.1  we  have  for  all
zâˆˆ(0,z
## ?
f
## )
## H
f
(z) = exp(âˆ’
## âˆ«
z
## ?
f
z
dÎ½
Î½âˆ’Ï†(Î½)
)H(z
## ?
f
## ) +
## âˆ«
z
## ?
f
z
H(Ï†(Î½)) exp(âˆ’
## âˆ«
Î½
z
dw
wâˆ’Ï†(w)
## )
dÎ½
Î½âˆ’Ï†(Î½)
## ,(29)
whereH
f
(Â·)  is  defined  in  (27).   To  obtain  the  smallest  concave  majorant  ofH
## (1)
(z)  =H
f
(z)âˆ’H(z)âˆ’
c/Ï†
## âˆ’
q
## (Ïˆ
## âˆ’1
q
(z)), we need to numerically evaluateH
f
(Â·).  To that end, it will be more convenient to rewrite
(29) into an equivalent first-order linear ODE form:
## ï£±
## ï£´
## ï£²
## ï£´
## ï£³
## H
## â€²
f
## (z) =
## H
f
(z)âˆ’H(Ï†(z))
zâˆ’Ï†(z)
## ,âˆ€zâˆˆ(0,z
## ?
f
## ),
subject toH
f
## (z
## ?
f
) =H(z
## ?
f
## ).
## (30)
Then  we  can  useMathematicaâ€™sNDSolvecommand  to  efficiently  compute  the  values  ofH
## (1)
(Â·)  and  its
derivatives.
## 6
5    Case Study: Trading with a Trailing Stop under the Exponential
OU Model
In this section, we apply our results in Section 4 to an exponential Ornstein-Uhlenbeck (OU) model:
dX
t
## =X
t
## (
Î»(Î¸âˆ’logX
t
## ) +
## 1
## 2
Ïƒ
## 2
## )
dt+ÏƒX
t
dW
t
## ,  X
## 0
=xâˆˆIâ‰¡R
## +
## ,(31)
whereWis a standard Brownian motion,Î»,Ïƒ >0 are positive constants, andÎ¸âˆˆRis the long term average
for the log-price logX:
d(logX
t
) =Î»(Î¸âˆ’logX
t
)dt+ÏƒdW
t
## .
## 6
The procedure can be conveniently generalized to allow for distinct discounting rates for the acquisition and liquidation
problems.
## 12
Electronic copy available at: https://ssrn.com/abstract=2895437

With reference to (9), it is well-known (see p.542 of Borodin and Salminen (2002)) that
Ï†
## +
q
## (x) =e
Î»
## 2Ïƒ
## 2
## (yâˆ’Î¸)
## 2
## D
## âˆ’
q
Î»
## (
## âˆš
## 2Î»
Ïƒ
## (yâˆ’Î¸)),
Ï†
## âˆ’
q
## (x) =e
Î»
## 2Ïƒ
## 2
## (yâˆ’Î¸)
## 2
## D
## âˆ’
q
Î»
## (
## âˆš
## 2Î»
Ïƒ
## (Î¸âˆ’y)),
wherey= logx, andD
Î½
(Â·) is the parabolic cylinder function with parameterÎ½.  We are interested in optimal
liquidation and acquisition of one unit of an risky asset whose price is modeled byX.  To that end, we let
h(x) =xâˆ’c
## 0
## ,  ,h
b
## (x) =x+c
## 0
,âˆ€xâˆˆI,
wherec
## 0
â‰¥0 is a transaction cost to buy or sell.  Then it follows that, for anyq >0
(Lâˆ’q)h(x) =
## (
Î»(Î¸âˆ’logx) +
## 1
## 2
Ïƒ
## 2
## âˆ’q
## )
x+qc
## 0
,âˆ€xâˆˆI,
which is a strictly decreasing function with range equal toR.  Moreover, by the asymptotic behavior ofD
Î½
## (Â·)
(see e.g.  equation (1.8) of Temme (2000)), we know that the reward functionh(Â·) satisfies Assumption 2.1.
A number of related studies, such as Zhang and Zhang (2008); Zervos et al. (2013); Leung and Wang (2018),
have also analyzed the optimal buy-low-sell-high strategy under the OU or exponential OU model, with or
without a fixed stop-loss exit.  Compared to them,  we study a different optimal stopping problem with a
random maturity due to the trailing stop.
5.1    Value Function and Optimal Strategy
Upon  purchasing  of  the  asset,  we  set  a  percentage  drawdown  trailing  stop,  i.e.f(x)  =  (1âˆ’Î±)x,  where
Î±âˆˆ(0,1) is a constant.
In this study, we select the following parameter values:
Î»= 0.6,Î¸= 1,Ïƒ= 0.2,q= 0.05,c
## 0
## = 0.02,Î±= 0.3.(32)
This means that we will liquidate the asset whenever its price drops from its running maximum since the
acquisition by more than 30%.
In Figure 2(a),  we plot the functionH(Â·) defined as in (27).  We also have plotted the functionH
f
## (Â·)
defined as in (23) (see also (29)), which is obtained by first solving equation (21) withf(x) = (1âˆ’Î±)xfor
b
## ?
f
(= 2.8845), and then using ODE (29) to numerically obtainH
f
(Â·).  We notice that, in contrast to the value
function for a fixed stop-loss level (Theorem 3.1, see also Leung and Li (2015)), the functionH
f
(Â·) is not
concave over (0,Ïˆ
q
## (b
## ?
f
)).  This is because, althoughÏ†
## âˆ’
q
(x)H
f
## (Ïˆ
q
## (x)) =v
f
(x,x) is the value function for the
optimal stopping problem (4) whenx=  Ì„x, it does not yield a martingale of (X
t
## ,
## X
t
), which requires using
the functionv
f
(x, Ì„x), notv
f
## (x,x).
In Figure 2(b), we plot the reward functionh(x) and the value functionv
f
(x,x) for the optimal liquidation
problem (4) withx=  Ì„x.
In Figure 2(c), we plot the functionH
## (1)
(z) defined in (25) under the current exponential OU model.
By checking the functionâ€™s derivative numerically, we conclude that it is concave to the left of its maximum
## 13
Electronic copy available at: https://ssrn.com/abstract=2895437

## 0.20.40.60.81.01.21.4
## 1
## 2
## 3
(a)H
f
(z) vs.H(z)
## 1.52.02.53.0
## 1.5
## 2.0
## 2.5
## 3.0
## (b)v
f
(x,x) vs.h(x)
## 0.51.01.52.0
## -0.05
## 0.05
## 0.10
## 0.15
## 0.20
(c)H
## (1)
(z) and its concave majorant
## 1.52.02.53.0
## 0.2
## 0.4
## 0.6
## 0.8
## 1.0
## 1.2
## (d)v
## (1)
f
(x) vs.v
f
## (x,x)âˆ’h
b
## (x)
Figure 2:  Numerical results under the exponential OU model (31):  (a) Plots of functionH(z) (dashed gray)
andH
f
(z) (solid black).  The â€œpasting pointâ€Ïˆ
q
## (b
## ?
f
) = 1.0674 is indicated by the black dot.  (b) Plots of
the reward functionh(x) (dashed gray) and the value functionv
f
(x,x) (solid black).  The â€œpasting pointâ€
isb
## ?
f
= 2.8845 (black dot).  (c) Plots of the reward functionH
## (1)
(z) (dashed gray) and its smallest concave
majorant  (solid  black),  along  with  the  â€œpasting  pointâ€   Ì„z
## ?
f
=  0.5441  (black  dot).   (d)  Plots  of  the  reward
functionv
f
## (x,x)âˆ’h
b
(x) (dashed gray) and the value functionv
## (1)
f
(x) (solid black), and the â€œpasting pointâ€
b
## ?
f
= 1.9488 (black dot).
point.  Hence, the smallest concave majorant is given by
## Ë†
## H
## (1)
f,q
(z) =H
## (1)
## (zâˆ§z
## ?
f
),âˆ€zâˆˆR
## +
## .
Therefore, in this case, the optimal acquisition strategy is to purchase the asset once the price is lower than
b
## ?
f
## = 1.9488.
In  Figure  2(d),  we  plot  the  functionv
f
## (x,x)âˆ’h
b
(x)  and  the  value  functionv
## (1)
f
(x)  for  the  optimal
acquisition problem (8), and the â€œpasting pointâ€ is atÏˆ
## âˆ’1
q
## ( Ì„z
## ?
f
## ) = 1.9488.
In summary, for the exponential OU model (31) with parameters as given in (32), the optimal trading
strategy is to  purchase the asset  when price is lower thanÏˆ
## âˆ’1
q
## ( Ì„z
## ?
f
) = 1.9488,  and setup the 30%  trailing
stop order as an exit plan, and then wait until either the trailing stop is being activated or the price reaches
targetb
## ?
f
## = 2.8845.
Lastly, in Figure 3 we plot the early liquidation premium ofÏ
f
## âˆ§Ï„
## +
## X
## (b
## ?
f
) over the plain trailing stopÏ
f
whenx=   Ì„x.  This measure the â€œvalueâ€ of our result in problem (4).  By Corollary 4.2, we know that, for
eachxâˆˆI,
p
f
(x,x) = exp(
## âˆ«
b
## ?
f
## âˆ¨x
x
## âˆ’Ïˆ
## â€²
q
## (u)du
Ïˆ
q
## (u)âˆ’Ïˆ
q
## (f(u))
## )
## (
h(b
## ?
f
## âˆ¨x)âˆ’g
f
## (b
## ?
f
## âˆ¨x,b
## ?
f
## âˆ¨x)
## )
## .(33)
To numerically evaluate (33), we use the fusion of a â€œlimiting orderâ€Ï„
## +
## X
(b) and the trailing stopÏ
f
, withb
## 14
Electronic copy available at: https://ssrn.com/abstract=2895437

## 1.52.02.53.03.54.0
## 0.4
## 0.6
## 0.8
## 1.0
## 1.2
Figure  3:  Earlier  liquidation  premium  (black)p
f
(x,x)  and  functionxâˆ’f(x)  =Î±x(dashed)  under  the
exponential OU model (31).
chosen sufficiently large so that
## E
x
## (e
## âˆ’q(Ï„
## +
## X
## (b)âˆ§Ï
f
## )
## 1
## {Ï„
## +
## X
## (b)<Ï
f
## }
## )<0.005,
0< h(b)E
x
## (e
## âˆ’q(Ï„
## +
## X
## (b)âˆ§Ï
f
## )
## 1
## {Ï„
## +
## X
## (b)<Ï
f
## }
## )<0.03,
for allxin the plotting region of Figure 3.  Theng
f
(x,x) is approximated by the value of this strategy, which
is subsequently solved using an ODE similar as (30).
In Figure 3, we compare the early liquidation premiump
f
(x,x) with the functionxâˆ’f(x) =Î±x(Î±= 0.3),
which is the maximum loss of the trailing stop order if the priceXreaches the trailing floor immediately
(but without an overshoot).  We notice that, for largex, the gain from our strategy over the plain trailing
stop approaches 30% of the price level.  Take into account of discounting and transaction costs, this example
suggests that setting a trailing stop when the asset price is high will almost always incur a 30% loss at exit.
5.2    Sensitivity Analysis and Financial Interpretations
The following illustrative numerical examples will shed light on the sensitivity of the optimal acquisition and
liquidation thresholds,b
## ?
f
andb
## ?
f
,  with respect to the trailing stop levelÎ±,  and transaction costc
## 0
## .  This
involve  numerical  computation  of  the  thresholds,  as  well  as  the  critical  level  where  function  (Lâˆ’q)h(x)
vanishes.  In Figure 4(a), we plot (b
## ?
f
## ,x
## 0
## ,b
## ?
f
) as a function of the trailing stop levelÎ±, withx
## 0
(the dashed
line) defined in Assumption 2.1.  The optimal liquidation levelb
## ?
f
is increasing inÎ±, confirming our result
in Theorem 4.2.  Moreover, the optimal acquisition levelb
## ?
f
is also increasing inÎ±.  Recalling that a higher
Î±means  a  lower  trailing  stop  trigger,  this  means  that  a  larger  downside  protection  induces  the  investor
to enter the market earlier.  As seen in Figure 4(a), the investor with a higherÎ±will acquire the asset at
a  price  level  closer  to  the  critical  levelx
## 0
.   Our  numerical  results  also  suggest  that,  for  smallÎ±,  it  may
not  be  optimal  to  initiate  the  position  at  all,  because  the  gain  to  be  realized  at  the  sell  order  atb
## ?
f
or
at  the  trailing  stop  will  be  too  low  compared  to  the  transaction  costc
## 0
.   In  such  cases,  we  observe  that
sup
xâˆˆR
## (v
f
(x,x)âˆ’h(x))< c
## 0
## = 0.02.
In  Figure  4(b),  we  plot  (b
## ?
f
## ,x
## 0
## ,b
## ?
f
)  as  a  function  of  the  assetâ€™s  volatility  parameterÏƒ.   We  see  that,
asÏƒincreases, the optimal liquidation level increases, thanks to stronger force from the Brownian motion.
However, the acquisition price level is lower for higherÏƒ, which means that the investor is willing to establish
## 15
Electronic copy available at: https://ssrn.com/abstract=2895437

## 0.150.200.250.300.350.40
## 1.8
## 2.0
## 2.2
## 2.4
## 2.6
## 2.8
## 3.0
## (a) (b
## ?
f
## ,x
## 0
## ,b
## ?
f
) vs.Î±
## 0.150.200.250.300.350.40
## 2.0
## 2.5
## 3.0
## (b) (b
## ?
f
## ,x
## 0
## ,b
## ?
f
) vs.Ïƒ
## 0.40.60.81.01.2
## 1.8
## 2.0
## 2.2
## 2.4
## 2.6
## 2.8
## 3.0
## (c) (b
## ?
f
## ,x
## 0
## ,b
## ?
f
) vs.Î»
## 0.010.020.030.04
## 2.0
## 2.2
## 2.4
## 2.6
## 2.8
## (d) (b
## ?
f
## ,x
## 0
## ,b
## ?
f
) vs.c
## 0
Figure 4:  Sensitivity of thresholdsb
## ?
f
## (black),b
## ?
f
(gray), and the rootx
## 0
(red dashed) of (Lâˆ’q)h(x) = 0,
under the exponential OU model (31):  (a) Dependence onÎ±âˆˆ[0.1,0.4]; (b) Dependence of onÏƒâˆˆ[0.1,0.4];
(c) Dependence of onÎ»âˆˆ[0.2,1.2], and (d) Dependence of onc
## 0
âˆˆ[0,0.04].  In all figures, other parameters
are set as in (32).
a position at a lower price.  However, higher volatility will increase the likelihood for the asset price to reach
low levels earlier, so the actual entry time by the investor may be earlier or later.  The decreasing pattern of
b
## ?
f
with respect toÏƒsuggests that the investor voluntarily lowers the take-profit level to mitigate the risk of
realizing a reduced profit or a loss at the trailing stop in a more volatile market.
Figure  4(c)  illustrates  the  effect  of  the  assetâ€™s  rate  of  mean  reversionÎ».   A  higherÎ»means  that  the
log-price will move around its long-term meanÎ¸faster.  As a response, the investor enters the market earlier
at a higher entry level and exit at a lower level, resulting in a quick roundtrip, as reflected in the plot by
the increasing trends ofb
## ?
f
andb
## ?
f
with respect toÎ».  Moreover, their distance is shrinking asÎ»continues
to increase.  Intuitively, since the asset price tends to rapidly revert to the mean, it does not make sense to
select entry and exit price levels that are far apart and away from the mean as the chance of execution is
too low.
The effect of transaction costc
## 0
is shown in Figure 4(d), where we plot (b
## ?
f
## ,x
## 0
## ,b
## ?
f
) as a function ofc
## 0
## .
The optimal liquidation levelb
## ?
f
increases slightly with respect toc
## 0
while the optimal acquisition levelb
## ?
f
decreases inc
## 0
.  To interpret, higher transaction costs discourage both acquisition and liquidation, though
the  effect  is  not  significant.   Nevertheless,  as  pointed  out  in  our  analysis  above,  while  there  is  always  a
finite optimal liquidation priceb
## ?
f
given any transaction cost, a high transaction cost may make the trade
unprofitable and thus exclude market entry.
## 16
Electronic copy available at: https://ssrn.com/abstract=2895437

## A    Proofs
Proof of Lemma 2.2.Following Dayanik and Karatzas (2003), let us define For anybâˆˆI, let us define
## H(z) :=
h(x)
Ï†
## âˆ’
q
## (x)
## ,wherez=Ïˆ
q
(x)âˆˆR
## +
## .(34)
By (Dayanik and Karatzas, 2003, Proposition 5.11), we know that the value function
V(x) := sup
Ï„âˆˆT
## E
x
## (e
## âˆ’rÏ„
h(X
Ï„
## )1
## {Ï„<âˆ}
## ),
is given byÏ†
## âˆ’
q
## (x)
## Ë†
## H(Ïˆ
q
(x)), where
## Ë†
H(Â·) is the smallest nonnegative concave majorant ofH(Â·) onR
## +
## .  On
the other hand, by (Dayanik and Karatzas, 2003, Section 6), we have
## H
## â€²â€²
## (z) =
## 2
Ïƒ
## 2
## (x)Ï†
## âˆ’
q
## (x)(Ïˆ
## â€²
q
## (x))
## 2
((Lâˆ’q)h(x)),forz=Ïˆ
q
## (x).
So Assumption 2.1 implies thatH(Â·) is convex on (0,Ïˆ
q
## (x
## 0
)), and concave on (Ïˆ
q
## (x
## 0
),âˆ).  We now examine
the behavior ofH(Â·) near 0 andâˆ.  From (34) we know that,
-  ifh(l+)â‰¥0, thenh(l+) is finite, andH(0+) = lim
xâ†“l
h(x)
Ï†
## âˆ’
q
## (x)
## = 0;
-  ifh(l+)<0, thenH(z)<0 for sufficiently smallz >0.
Moreover, from
## F(z) :=
## H(z)
z
## =
h(x)
Ï†
## +
q
## (x)
## ,wherez=Ïˆ
q
## (x)
we knowH(z)>0 for sufficiently largez >0.  Here, functionF(Â·) is twice continuously differentiable on
## R
## +
, and by Assumption 2.1 we know that sup
zâ‰¥Ïˆ
q
## (x
## 0
## )
F(z) =F(z
## âˆ—
) for somez
## âˆ—
## âˆˆ[Ïˆ
q
## (x
## 0
## ),âˆ).  Obviously
## F(z
## âˆ—
)>0, which implies thatH(z) =
h(x)
Ï†
## âˆ’
q
## (x)
>0 for allz > z
## âˆ—
sinceh(Â·) is monotone.  Furthermore,z
## âˆ—
must
satisfy the first order condition
## 1
z
## âˆ—
## (H
## â€²
## (z
## âˆ—
)âˆ’F(z
## âˆ—
## )) = 0.(35)
Now define function
## Ìƒ
H(z) =F(z
## âˆ—
## )z1
## {z<z
## âˆ—
## }
+H(z)1
## {zâ‰¥z
## âˆ—
## }
## ,
which is clearly continuously differentiable and concave onR
## +
, thanks to (35).  Function
## Ìƒ
H(Â·) is also positive
onR
## +
, which is evident from the construction.  Hence we conclude that
## Ìƒ
H(Â·) is the smallest concave majorant
ofH(Â·).  So the optimal stopping region is given by
Ïˆ
## âˆ’1
q
({zâˆˆR
## +
## :
## Ìƒ
H(z) =H(z)}) = (Ïˆ
## âˆ’1
q
## (z
## âˆ—
## ),r).
## Therefore,x
## ?
## =Ïˆ
## âˆ’1
q
## (z
## âˆ—
) is the optimal stopping threshold.
Proof of Proposition 3.1.The proof is similar as that for Lemma 2.2.  In the spirit of Dayanik and Karatzas
(2003), we derive the optimal value function and the stopping region by constructing the smallest concave
## 17
Electronic copy available at: https://ssrn.com/abstract=2895437

majorant ofH(z) on [Ïˆ
q
(y),âˆ).  By the convexity ofH(Â·), we know this concave majorant is given by
## Ë†
## H
y
## (z) =
## ï£±
## ï£´
## ï£²
## ï£´
## ï£³
## H(Ïˆ
q
## (y))
z(y)âˆ’z
z(y)âˆ’Ïˆ
q
## (y)
+H(z(y))
zâˆ’Ïˆ
q
## (y)
z(y)âˆ’Ïˆ
q
## (y)
## ,âˆ€zâˆˆ(Ïˆ
q
## (y),z(y)),
## H(z),âˆ€z6âˆˆ(Ïˆ
q
## (y),z(y)),
## (36)
wherez(y) is defined as
z(y) := inf arg max
z>Ïˆ
q
## (x
## 0
## )
H(z)âˆ’H(Ïˆ
q
## (y))
zâˆ’Ïˆ
q
## (y)
## .(37)
Thus, the optimal stopping region is given by
## S
## S,L
y
## =Ïˆ
## âˆ’1
q
## (R
## +
## \(Ïˆ
q
## (y),z(y))) = (l,y]âˆª[Ïˆ
## âˆ’1
q
## (z(y)),r).
Therefore, the optimal stopping barrier is given byb(y) :=Ïˆ
## âˆ’1
q
## (z(y)).
From Remark 3.1 we know that, forlâ‰¤y
## 1
< y
## 2
< x
## 0
, the equalities hold:
## ((l,y
## 1
## ]âˆª[b(y
## 1
),r))â‰¡S
## S,L
y
## 1
## âŠ‚S
## S,L
y
## 2
## â‰¡((l,y
## 2
## ]âˆª[b(y
## 2
## ),r)).
Thus  necessarily,b(y
## 2
## )â‰¤b(y
## 1
## )â‰¤b(l)  =x
## âˆ—
< r.   Becausez(y)  is  an  interior  maximizer  in  the  objective
function in (37), it must satisfy the first order condition:
## 1
z(y)âˆ’Ïˆ
q
## (y)
## (
## H
## â€²
## (z(y))âˆ’
H(z(y))âˆ’H(Ïˆ
q
## (y))
z(y)âˆ’Ïˆ
q
## (y)
## )
## = 0.(38)
This gives (20).
## Asyâ†‘x
## 0
,b(y) converges to some limit in [x
## 0
,r).  Suppose thatb(x
## 0
âˆ’)â‰¡b> x
## 0
, then the concavity of
H(Â·) over (Ïˆ
q
## (x
## 0
),âˆ) implies that
## H
## â€²
## (Ïˆ
q
## (b
## ))â‰¤
## H(Ïˆ
q
## (b
))âˆ’H(Ïˆ
q
## (x
## 0
## ))
Ïˆ
q
## (b)âˆ’Ïˆ
q
## (x
## 0
## )
## .
However,  taking  limit  in  (38)  asyâ†‘x
## 0
,  we  know  that  the  above  inequality  is  in  fact  an  equality.   This,
together with the concavity ofH(Â·) implies thatH(Â·) is in fact a straight line over [Ïˆ
q
## (x
## 0
## ),Ïˆ
q
(b)], but then
(by the definition ofz(y), again) we must haveb(x
## 0
## âˆ’) =x
## 0
instead.
We use implicit differentiation to proveb(y) is strictly decreasing and differentiable on (l,x
## 0
).  To that
end, we denotez=z(y) andu=Ïˆ
q
(y), then the first order equation in (38) reads as
f(z,u) = 0,wheref(z,w) =H
## â€²
## (z)âˆ’
H(z)âˆ’H(u)
zâˆ’u
## .
By the definition ofzâ‰¡z(y) we have
## âˆ‚f
## âˆ‚u
## =H
## â€²
## (u)âˆ’
H(z)âˆ’H(u)
## (zâˆ’u)
## <0,
## âˆ‚f
## âˆ‚z
## =H
## â€²â€²
## (z)âˆ’
## 1
zâˆ’u
f(z,u) =H
## â€²â€²
## (z)<0.
Thus, we know thatz(y) is strictly decreasing and differentiable inÏˆ
q
(y). In order words,z(y) is differentiable
inyandz
## â€²
(y)<0 for anyyâˆˆ(l,x
## 0
## ).
## 18
Electronic copy available at: https://ssrn.com/abstract=2895437

Proof of Corollary 4.1.From Theorem 3.1 we know that   Ì„x7â†’b(f( Ì„x)) is strictly decreasing and continuous
over (f
## âˆ’1
## (l),f
## âˆ’1
## (x
## 0
)), and the mapping  Ì„x:7â†’ Ì„xis strictly increasing over the same domain.  Therefore, the
differenceD( Ì„x) :=b(f( Ì„x))âˆ’ Ì„xis strictly decreasing, andD( Ì„x)â‰¥D(x
## 0
)>0 for all  Ì„xâˆˆ(f
## âˆ’1
## (l),x
## 0
], and by
## Proposition 3.1,
lim
## Ì„xâ†‘f
## âˆ’1
## (x
## 0
## )
## D( Ì„x) =x
## 0
## âˆ’f
## âˆ’1
## (x
## 0
## )<0.
As a consequence, we can defineb
## ?
f
:= inf{ Ì„x < f
## âˆ’1
## (x
## 0
) :D( Ì„x)â‰¤0}, andb
## ?
f
## âˆˆ(x
## 0
## ,f
## âˆ’1
## (x
## 0
)), sof(b
## ?
f
## )â‰¤x
## 0
## .
Now for all  Ì„x < b
## ?
f
, by the construction ofb
## ?
f
we haveb(f( Ì„x))> Ì„x, by definition ofz(f( Ì„x))â‰¡Ïˆ
q
## (b(f( Ì„x)))
in  the  proof  of  Proposition  3.1  we  know  thatz(f( Ì„x))> Ïˆ
q
( Ì„x).   Because  the  line  segmentl
## 0
connecting
## (Ïˆ
q
(f( Ì„x)),H(Ïˆ
q
(f( Ì„x)))) and (z(f( Ì„x)),H(Ïˆ
q
(f( Ì„x)))) gives part of the concave majorant ofH(Â·),  we know
that  the  line  segmentl
## 1
connecting  (Ïˆ
q
(f( Ì„x)),H(Ïˆ
q
(f( Ì„x))))  and  (Ïˆ
q
( Ì„x),H(Ïˆ
q
( Ì„x))),  which  is  below  line
segmentl
## 0
,  must go below the graph ofH(Â·) atÏˆ
q
( Ì„x).  This implies that the derivative ofH(Â·) atÏˆ
q
## ( Ì„x)
must be strictly greater than that of line segmentl
## 1
.  That is,
## H
## â€²
## (Ïˆ
q
## ( Ì„x))>
## H(Ïˆ
q
( Ì„x))âˆ’H(Ïˆ
q
## (f( Ì„x)))
Ïˆ
q
## ( Ì„x)âˆ’Ïˆ
q
## (f( Ì„x))
â‡”Î“( Ì„x)>0.
On the other hand, for allf
## âˆ’1
## (x
## 0
)> Ì„x > b
## ?
f
, we haveb(f( Ì„x))< Ì„x.  Using similar argument as above, we
know thatz(f( Ì„x)) =Ïˆ
q
(b(f( Ì„x)))< Ïˆ
q
( Ì„x).  Since the line segmentl
## 1
connecting (Ïˆ
q
(f( Ì„x)),H(Ïˆ
q
(f( Ì„x)))) and
## (Ïˆ
q
( Ì„x),H(Ïˆ
q
( Ì„x))) is a line segment connecting two points on the graph of a concave function
## Ë†
H(Â·), which is
the smallest concave majorant ofH(Â·) over [Ïˆ
q
(f( Ì„x)),âˆ), we know that
## Ë†
## H
## â€²
## (Ïˆ
q
( Ì„x)) =H
## â€²
## (Ïˆ
q
## ( Ì„x))<
## H(Ïˆ
q
( Ì„x))âˆ’H(Ïˆ
q
## (f( Ì„x)))
Ïˆ
q
## ( Ì„x)âˆ’Ïˆ
q
## (f( Ì„x))
â‡”Î“( Ì„x)<0.
ExpressingH(Â·) and its derivative withh(Â·),Ï†
## âˆ’
q
## (Â·),Ïˆ
q
(Â·) and their derivatives yields (21) and completes the
proof.
Proof of Lemma 4.1.Let us denote bye
q
an exponential random variable with mean 1/q, which is indepen-
dent ofX.  Then we notice that
## E
## Ì„x, Ì„x
## (e
## âˆ’qÏ
f
h(X
Ï
f
## )1
## {Ï„
## +
## X
## (b)<Ï
f
## }
## ) =E
## Ì„x, Ì„x
(h(X
Ï
f
## )1
## {Ï
f
## <Ï„
## +
## X
## (b)âˆ§e
q
## }
## ),
## E
## Ì„x, Ì„x
## (e
## âˆ’qÏ„
## +
## X
## (b)
## 1
## {Ï„
## +
## X
## (b)<Ï
f
## }
## ) =P
## Ì„x, Ì„x
## (Ï„
## +
## X
(b)< Ï
f
## âˆ§e
q
## ).
To calculate the right-hand sides of the above, we consider an excursion ofXbelowu(notice thatÏ„
## +
## X
## (uâˆ’) =
inf{t >0 :X
t
â‰¥u}is the first hitting time ofXtou):
## 
u
## ={
u
(s) :=X
Ï„
## +
## X
## (uâˆ’)
## âˆ’X
Ï„
## +
## X
## (uâˆ’)+s
## }
## 0<sâ‰¤Ï„
## +
## X
## (u)âˆ’Ï„
## +
## X
## (uâˆ’)
## ,
which is defined for alluâ‰¥X
## 0
## =
## X
## 0
=  Ì„xsuch that its lifetimeÎ¶(
u
## ) :=Ï„
## +
## X
## (u)âˆ’Ï„
## +
## X
## (uâˆ’)>0.  WhenÎ¶(
u
## ) = 0
we set
u
=âˆ‚, an isolated point.  Then the process{(u,
u
## )}
uâ‰¥ Ì„x
is a Poisson point process with jump measure
duÃ—dn
u
, wheren
u
is the excursion measure for
u
.  DefineT
f
## (
u
) := inf{0< s < Î¶(
u
## ) :
u
(s)> uâˆ’f(u)}.
## 19
Electronic copy available at: https://ssrn.com/abstract=2895437

It is known from Salminen et al. (2007) and Lemma 2.1 that,
n
u
## (e
q
< Î¶(
u
## )âˆ§T
f
## (
u
)) = lim
xâ†‘u
## 1
uâˆ’x
## (
## 1âˆ’E
x
## (e
## âˆ’qÏ„
## +
## X
## (u)
## 1
## {Ï„
## +
## X
## (u)<Ï„
## âˆ’
## X
## (f(u))}
## )
## )
## âˆ’lim
xâ†‘u
## E
x
## (e
## âˆ’qÏ„
## âˆ’
## X
## (f(u))
## 1
## {Ï„
## âˆ’
## X
## (f(u))<Ï„
## +
## X
## (u)}
## )
uâˆ’x
## =
Ï†
## âˆ’,â€²
q
## (u)
Ï†
## âˆ’
q
## (u)
## +
## (
## 1âˆ’
Ï†
## âˆ’
q
## (u)
Ï†
## âˆ’
q
## (f(u))
## )
Ïˆ
## â€²
q
## (u)
Ïˆ
q
## (u)âˆ’Ïˆ
q
## (f(u))
## ,
n
u
## (T
f
## (
u
)< Î¶(
u
## )âˆ§e
q
) = lim
xâ†‘u
## E
x
## (e
## âˆ’qÏ„
## âˆ’
## X
## (f(u))
## 1
## {Ï„
## âˆ’
## X
## (f(u))<Ï„
## +
## X
## (u)}
## )
uâˆ’x
## =
Ï†
## âˆ’
q
## (u)
Ï†
## âˆ’
q
## (f(u))
Ïˆ
## â€²
q
## (u)
Ïˆ
q
## (u)âˆ’Ïˆ
q
## (f(u))
## .
## Hence,
n
u
## (e
q
< Î¶(
u
## )âˆ§T
f
## (
u
) orT
f
## (
u
)< Î¶(
u
## )âˆ§e
q
## ) =
Ï†
## âˆ’,â€²
q
## (u)
Ï†
## âˆ’
q
## (u)
## âˆ’
Ïˆ
## â€²
q
## (u)
Ïˆ
q
## (u)âˆ’Ïˆ
q
## (f(u))
## .
LetAbe the space of all excursions
u
such thatT
f
## (
u
)< Î¶(
u
## )âˆ§e
q
, andBbe the space of all excursions
## 
u
such thate
q
< Î¶(
u
## )âˆ§T
f
## (
u
).  We have thatAâˆ©B=âˆ….  Consider a Poisson process (with time indexed
by the running maximum
X) that jumps whenever the current excursion
## X
âˆˆAâˆªB, then from the above
calculation,  we  know  that  this  Poisson  process  has  jump  intensityn
u
## (e
q
< Î¶(
u
## )âˆ§T
f
## (
u
) orT
f
## (
u
## )<
Î¶(
u
## )âˆ§e
q
).  SoP
## Ì„x, Ì„x
## (Ï„
## +
## X
(b)< Ï
f
## âˆ§e
q
) is the same as the probability that this Poisson process has no jump
over [ Ì„x,b), which is given by
exp(âˆ’
## âˆ«
b
## Ì„x
n
u
## (e
q
< Î¶(
u
## )âˆ§T
f
## (
u
) orT
f
## (
u
)< Î¶(
u
## )âˆ§e
q
## )du) =
Ï†
## âˆ’
q
## ( Ì„x)
Ï†
## âˆ’
q
## (b)
exp(âˆ’
## âˆ«
b
## Ì„x
Ïˆ
## â€²
q
## (u)du
Ïˆ
q
## (u)âˆ’Ïˆ
q
## (f(u))
## ).
Moreover, for anyvâˆˆ[ Ì„x,b), the probability that the Poisson process will have the first jump at â€œtimeâ€
dvas a result of
v
âˆˆA, is given by
exp(âˆ’
## âˆ«
v
## Ì„x
n
u
## (e
q
< Î¶(
u
## )âˆ§T
f
## (
u
) orT
f
## (
u
)< Î¶(
u
## )âˆ§e
q
## )du)Â·n
v
## (T
f
## (
v
)< Î¶(
v
## )âˆ§e
q
## )dv
## =
Ï†
## âˆ’
q
## ( Ì„x)
Ï†
## âˆ’
q
## (v)
exp(âˆ’
## âˆ«
v
## Ì„x
Ïˆ
## â€²
q
## (u)du
Ïˆ
q
## (u)âˆ’Ïˆ
q
## (f(u))
## )Ã—
Ï†
## âˆ’
q
## (v)
Ï†
## âˆ’
q
## (f(v))
Ïˆ
## â€²
q
## (v)
Ïˆ
q
## (v)âˆ’Ïˆ
q
## (f(v))
dv
## =
Ï†
## âˆ’
q
## ( Ì„x)
Ï†
## âˆ’
q
## (f(v))
Ïˆ
## â€²
q
## (v)
Ïˆ
q
## (v)âˆ’Ïˆ
q
## (f(v))
exp(âˆ’
## âˆ«
v
## Ì„x
Ïˆ
## â€²
q
## (u)du
Ïˆ
q
## (u)âˆ’Ïˆ
q
## (f(u))
## )dv,
which  is  the  same  asP
## Ì„x, Ì„x
## (
## X
Ï
f
## âˆˆdv,Ï
f
< Ï„
## +
## X
## (b)âˆ§e
q
).   The  proof  is  complete  by  integrating  invover
## [ Ì„x,b).
Proof of Lemma 4.2.Let us define for anybâ‰¥ Ì„x
## Ì„
## H(Ïˆ
q
( Ì„x),b) :=H(Ïˆ
q
(b)) exp(âˆ’
## âˆ«
b
## Ì„x
Ïˆ
## â€²
q
(u) du
Ïˆ
q
## (u)âˆ’Ïˆ
q
## (f(u))
## )
## +
## âˆ«
b
## Ì„x
Ïˆ
## â€²
q
(v)H(Ïˆ
q
## (f(v)))
w(v)âˆ’w(f(v))
exp(âˆ’
## âˆ«
v
## Ì„x
Ïˆ
## â€²
q
## (u)
Ïˆ
q
## (u)âˆ’Ïˆ
q
## (f(u))
du)dv.
It is clear that
## Ì„
## H(Ïˆ
q
( Ì„x), Ì„x) =H(Ïˆ
q
## ( Ì„x)) =
h( Ì„x)
Ï†
## âˆ’
q
## ( Ì„x)
, and forb > Ì„xwe have the right derivative ofH
f
## (Ïˆ
q
## ( Ì„x),b)
## 20
Electronic copy available at: https://ssrn.com/abstract=2895437

inb:
## âˆ‚
## âˆ‚b
## Ì„
## H(Ïˆ
q
## ( Ì„x),b)
## =Ïˆ
## â€²
q
(b) exp(âˆ’
## âˆ«
b
## Ì„x
Ïˆ
## â€²
q
## (u)du
Ïˆ
q
## (u)âˆ’Ïˆ
q
## (f(u))
## )
## (
## H
## â€²
## +
## (Ïˆ
q
## (b))âˆ’
## H(Ïˆ
q
(b))âˆ’H(Ïˆ
q
## (f(b)))
Ïˆ
q
## (b)âˆ’Ïˆ
q
## (f(b))
## )
## .
It follows that the sign of
## âˆ‚
## âˆ‚b
## Ì„
## H(Ïˆ
q
( Ì„x),b) depends on that of
Î“(b) =H
## â€²
## (Ïˆ
q
## (b))âˆ’
## H(Ïˆ
q
(b))âˆ’H(Ïˆ
q
## (f(b)))
Ïˆ
q
## (b)âˆ’Ïˆ
q
## (f(b))
## .
But the latter is known to be positive for allb < b
## ?
f
, thanks to Corollary 4.1.  BecauseH
## â€²
## (Ïˆ
q
(Â·)) is continuous,
so is Î“(Â·).  So we know that
u
f
## (x, Ì„x)
Ï†
## âˆ’
q
## (x)
## =
## Ì„
## H(Ïˆ
q
## ( Ì„x),b
## ?
f
) =H(Ïˆ
q
## ( Ì„x)) +
## âˆ«
b
## ?
f
## Ì„x
## âˆ‚
## âˆ‚u
## Ì„
## H(Ïˆ
q
## ( Ì„x),u)du > H(Ïˆ
q
## ( Ì„x)) =
h(x)
Ï†
## âˆ’
q
## (x)
,âˆ€ Ì„x < b
## ?
f
## .
This completes the proof.
Proof of Corollary 4.2.Iff( Ì„x)< xâ‰¤ Ì„x < b
## ?
f
, then by the strong Markov property ofX, we have
p
f
(x, Ì„x) =E
x, Ì„x
## ([e
## âˆ’qÏ„
## +
## X
## (b
## ?
f
## )
h(X
Ï„
## +
## X
## (b
## ?
f
## )
## )âˆ’e
## âˆ’qÏ
f
h(X
Ï
f
## )]1
## {Ï„
## +
## X
## (b
## ?
f
## )<Ï
f
## <âˆ}
## )
## =E
x, Ì„x
## (e
## âˆ’qÏ„
## +
## X
## (b
## ?
f
## )
## 1
## {Ï„
## +
## X
## (b
## ?
f
## )<Ï
f
## }
## )
## (
h(b
## ?
f
## )âˆ’E
b
## ?
f
## ,b
## ?
f
## (e
## âˆ’qÏ
f
h(X
Ï
f
## )1
## {Ï
f
## <âˆ}
## )
## )
## ,
whereE
b
## ?
f
## ,b
## ?
f
## (e
## âˆ’qÏ
f
h(X
Ï
f
## )1
## {Ï
f
## <âˆ}
## ) =g
f
## (b
## ?
f
## ,b
## ?
f
) is given in Lemma 4.1, which is finite since we know that it
is dominated from above byv
f
## (b
## ?
f
## ,b
## ?
f
## ) =h(b
## ?
f
).  On the other hand, by the analysis in (22) and the results
in Lemma 4.1, we have
## E
x, Ì„x
## (e
## âˆ’qÏ„
## +
## X
## (b
## ?
f
## )
## 1
## {Ï„
## +
## X
## (b
## ?
f
## )<Ï
f
## }
## ) =
Ï†
## âˆ’
q
## (x)
Ï†
## âˆ’
q
## (b
## ?
f
## )
Ïˆ
q
## (x)âˆ’Ïˆ
q
## (f( Ì„x))
Ïˆ
q
## ( Ì„x)âˆ’Ïˆ
q
## (f( Ì„x))
exp(âˆ’
## âˆ«
b
## ?
f
## Ì„x
Ïˆ
## â€²
q
## (u)du
Ïˆ
q
## (u)âˆ’Ïˆ
q
## (f(u))
## ).
We obtain the claimed formula by combining the above results.
Iff( Ì„x)< x
## 0
and  Ì„xâ‰¥b
## ?
f
, then from Theorem 3.1 and Theorem 4.1 we know thatb(f( Ì„x))â‰¤ Ì„x, and for all
f( Ì„x)< x < b(f( Ì„x)),
p
f
(x, Ì„x) =E
x
## (e
## âˆ’qÏ„
## +
## X
## (b(f( Ì„x)))
## 1
## {Ï„
## +
## X
## (b(f( Ì„x)))<Ï„
## âˆ’
## X
## (f( Ì„x))}
## )
## (
h(b(f( Ì„x)))âˆ’E
b(f( Ì„x), Ì„x
## (e
## âˆ’qÏ
f
h(X
Ï
f
## )1
## {Ï
f
## <âˆ}
## )
## )
## .
By using Lemma 2.1 we obtain that
## E
x
## (e
## âˆ’qÏ„
## +
## X
## (b(f( Ì„x)))
## 1
## {Ï„
## +
## X
## (b(f( Ì„x)))<Ï„
## âˆ’
## X
## (f( Ì„x))}
## ) =
Ï†
## âˆ’
q
## (x)
Ï†
## âˆ’
q
## (b(f( Ì„x)))
Ïˆ
q
## (x)âˆ’Ïˆ
q
## (f( Ì„x))
Ïˆ(b(f( Ì„x)))âˆ’Ïˆ
q
## (f( Ì„x))
## .
The claim in this case follows from Lemma 4.1.
In the last case thatf( Ì„x)< x
## 0
## ,   Ì„xâ‰¥b
## ?
f
andb(f( Ì„x))â‰¤xâ‰¤ Ì„x,  orf( Ì„x)â‰¥x
## 0
andf( Ì„x)< xâ‰¤ Ì„x,  from
Theorem 3.1 and Theorem 4.1 we know that the optimal stopping rule for problem (4) is 0, so we have
p
f
(x, Ì„x) =h(x)âˆ’E
x, Ì„x
## (e
## âˆ’qÏ
f
h(X
Ï
f
## )1
## {Ï
f
## <âˆ}
## ).
## 21
Electronic copy available at: https://ssrn.com/abstract=2895437

The completes the proof.
Proof of Lemma 4.3.The convexity ofH(Â·) has already been proved in the proof of Lemma 2.2, so we only
need to prove that forH
f
(Â·).  To that end, we recall (30) that
## H
## â€²
f
## (z) =
## H
f
(z)âˆ’H(Ï†(z))
zâˆ’Ï†(z)
## ,âˆ€zâˆˆ(0,z
## ?
f
## ),
from which we obtain that, forzâˆˆ(0,z
## ?
f
## ),
dH
## â€²
f
## (z) =
## H
f
(z)âˆ’H(Ï†(z))
zâˆ’Ï†(z)
dzâˆ’H
## â€²
## (Ï†(z))dÏ†(z)
zâˆ’Ï†(z)
## âˆ’
## H
f
(z)âˆ’H(Ï†(z))
## (zâˆ’Ï†(z))
## 2
## (dzâˆ’dÏ†(z))
## =
## (
## H
f
(z)âˆ’H(Ï†(z))
zâˆ’Ï†(z)
## âˆ’H
## â€²
## (Ï†(z))
## )
dÏ†(z)
zâˆ’Ï†(z)
## â‰¥
## (
H(z)âˆ’H(Ï†(z))
zâˆ’Ï†(z)
## âˆ’H
## â€²
## (Ï†(z))
## )
dÏ†(z)
zâˆ’Ï†(z)
## .(39)
We prove that the embraced expression in (39) is positive, which implies thatH
## â€²
f
(Â·) is increasing soH
f
(Â·) is
convex.
To prove the claim, we notice that forzâˆˆ(0,z
## ?
f
), we haveÏ†(z)< Ï†(z
## ?
f
## ) =Ïˆ
q
## (f(Ïˆ
## âˆ’1
q
## (z
## ?
f
## ))) =Ïˆ
q
## (f(b
## ?
f
## ))<
Ïˆ
q
## (x
## 0
),  thanks  to  Corollary  4.1.   We  now  prove  that  the  line  segment  connecting  (Ï†(z),H(Ï†(z)))  and
(z,H(z)) stays above the graph ofH(Â·).  Suppose not, then by the convexity ofH(Â·) this can happen only if
the line segment crosses the graph ofH(Â·) twice, andz > Ïˆ
q
## (b(Ïˆ
## âˆ’1
q
(Ï†(z)))), the latter of which is the point
where the tangent line ofH(Â·) that crosses (Ï†(z),H(Ï†(z))) touches the graph ofH(Â·).  In other words,
Ïˆ
## âˆ’1
q
(z)> b(Ïˆ
## âˆ’1
q
## (Ï†(z)).(40)
On the other hand, by the monotonicity ofb(y) (see Proposition 3.1) we know that
b(Ïˆ
## âˆ’1
q
(Ï†(z))> b(Ïˆ
## âˆ’1
q
## (Ï†(z
## ?
f
## )) =b
## ?
f
## ,(41)
where we used the definition ofb
## ?
f
in Corollary 4.1.  However, (40) is contradictory to (41).  Thus, the the
line segment connecting (Ï†(z),H(Ï†(z))) and (z,H(z)) stays above the graph ofH(Â·).  Given thatH(Â·) is
convex atÏ†(z), we know that the slope of this line segment,
H(z)âˆ’H(Ï†(z))
zâˆ’Ï†(z)
, is larger thanH
## â€²
## (Ï†(z)).
Lemma A.1.Define the constantÎ²
## Â±
## :=âˆ’Î´Â±Î³,where
Î´=
Î¼
Ïƒ
## 2
## âˆ’
## 1
## 2
,  Î³=
## âˆš
Î´
## 2
## +
## 2q
Ïƒ
## 2
## .
Then, we haveÎ²
## +
## >1and
## âˆ’âˆ’Î²
## âˆ’
## 2Î³
## ,
## 1âˆ’Î²
## âˆ’
## 2Î³
## âˆˆ(0,1).(42)
Proof.First,  sinceg(1)  =Î¼âˆ’q < g(Î²
## +
)  =  0  whereg(Î²)  =
## 1
## 2
Ïƒ
## 2
Î²(Î²âˆ’1) +Î¼Î²âˆ’q,  we  conclude  that
1< Î²
## +
.  It follows fromÎ´ < Î³thatâˆ’Î²
## âˆ’
=Î´+Î³ <2Î³,  soâˆ’
Î²
## âˆ’
## 2Î³
<1.  Fromg(âˆ’)< g(Î²
## âˆ’
) = 0 where
g(Î²) =
## 1
## 2
Ïƒ
## 2
Î²(Î²âˆ’1) +Î¼Î²âˆ’q, we know thatâˆ’ > Î²
## âˆ’
## .  Moreover, 1âˆ’Î²
## âˆ’
## âˆ’2Î³= 1 +Î´âˆ’Î³= 1 +Î´âˆ’
## âˆš
Î´
## 2
## +
## 2q
Ïƒ
## 2
## <
Î´+ 1âˆ’
## âˆš
Î´
## 2
## +
## 2Î¼
Ïƒ
## 2
## =Î´+ 1âˆ’
## âˆš
Î´
## 2
+ 2Î´+ 1â‰¤0, so
## 1âˆ’Î²
## âˆ’
## 2Î³
## <1.
## 22
Electronic copy available at: https://ssrn.com/abstract=2895437

Proof of Example 4.1.First of all, we verify thath(Â·) satisfies Assumption 2.1.  To that end, we calculate
(Lâˆ’q)h(x) = (Î¼âˆ’q)xâˆ’[
## 1
## 2
Ïƒ
## 2
(1 +)âˆ’Î¼âˆ’q]Kx
## âˆ’
## ,
from which we know that (12) holds.  From Borodin and Salminen (2002) we know that
Ï†
## Â±
q
## (x) =x
Î²
## Â±
## ,Ïˆ
q
## (x) =x
Î²
## +
## âˆ’Î²
## âˆ’
## =x
## 2Î³
## ,(43)
whereÎ²
## Â±
is defined in Lemma A.1.  Condition (13) holds sinceÎ²
## +
>1, and thus, Assumption 2.1 holds.
Using (43) andf(x) = (1âˆ’Î±)xwe obtain that
## H(z) =z
## 1âˆ’Î²
## âˆ’
## 2Î³
âˆ’Kz
## âˆ’âˆ’Î²
## âˆ’
## 2Î³
,  Ï†(z) = (z
## 1
## 2Î³
## (1âˆ’Î±))
## 2Î³
## = (1âˆ’Î±)
## 2Î³
z=:  Ì„Î±z.(44)
## H
## â€²â€²
## (z) =n
## 1
## (n
## 1
## âˆ’1)z
n
## 1
## âˆ’2
âˆ’Kn
## 2
## (n
## 2
## âˆ’1)z
n
## 2
## âˆ’2
## =z
n
## 2
## âˆ’2
## [n
## 1
## (n
## 1
## âˆ’1)z
n
## 1
## âˆ’n
## 2
+Kn
## 2
## (1âˆ’n
## 2
## )]
## 1
## 2
Ïƒ
## 2
## (âˆ’)(âˆ’âˆ’1)âˆ’Î¼âˆ’q <0,
## 1
## 2
Ïƒ
## 2
## (+ 1)âˆ’Î¼âˆ’q <0.
It follows that
## H
f
(z) = exp(âˆ’
## âˆ«
z
## ?
f
z
dÎ½
Î½âˆ’Ï†(Î½)
)H(z
## ?
f
## ) +
## âˆ«
z
## ?
f
z
H(Ï†(Î½)) exp(âˆ’
## âˆ«
Î½
z
dw
wâˆ’Ï†(w)
## )
dÎ½
Î½âˆ’Ï†(Î½)
## =
## (
z
z
## ?
f
## )
## 1
## 1âˆ’ Ì„Î±
## [(z
## ?
f
## )
## 1âˆ’Î²
## âˆ’
## 2Î³
âˆ’K(z
## ?
f
## )
## âˆ’âˆ’Î²
## âˆ’
## 2Î³
## ] +
## (  Ì„Î±)
## 1âˆ’Î²
## âˆ’
## 2Î³
## (1âˆ’ Ì„Î±)
## 1âˆ’Î²
## âˆ’
## 2Î³
## âˆ’1
## [(z
## ?
f
## )
## 1âˆ’Î²
## âˆ’
## 2Î³
## (
z
z
## ?
f
## )
## 1
## 1âˆ’ Ì„Î±
## âˆ’z
## 1âˆ’Î²
## âˆ’
## 2Î³
## ]
## âˆ’K
## (  Ì„Î±)
## âˆ’âˆ’Î²
## âˆ’
## 2Î³
## (1âˆ’ Ì„Î±)
## âˆ’âˆ’Î²
## âˆ’
## 2Î³
## âˆ’1
## [(z
## ?
f
## )
## âˆ’âˆ’Î²
## âˆ’
## 2Î³
## (
z
z
## ?
f
## )
## 1
## 1âˆ’ Ì„Î±
## âˆ’z
## âˆ’âˆ’Î²
## âˆ’
## 2Î³
## ].(45)
Notice that (42) ensures that two detonators in the last line of (45) are negative.
Using (43), (44) and (45), we obtain
## H
## (1)
## (z)
## =H
f
(z)âˆ’H(z)
## =
## (
## (  Ì„Î±)
## 1âˆ’Î²
## âˆ’
## 2Î³
## + (1âˆ’ Ì„Î±)
## 1âˆ’Î²
## âˆ’
## 2Î³
## âˆ’1
## (1âˆ’ Ì„Î±)
## 1âˆ’Î²
## âˆ’
## 2Î³
## âˆ’1
## (z
## ?
f
## )
## 1âˆ’Î²
## âˆ’
## 2Î³
## âˆ’K
## (  Ì„Î±)
## âˆ’âˆ’Î²
## âˆ’
## 2Î³
## + (1âˆ’ Ì„Î±)
## âˆ’âˆ’Î²
## âˆ’
## 2Î³
## âˆ’1
## (1âˆ’ Ì„Î±)
## âˆ’âˆ’Î²
## âˆ’
## 2Î³
## âˆ’1
## (z
## ?
f
## )
## âˆ’Î²
## âˆ’
## 2Î³
## )(
z
z
## ?
f
## )
## 1
## 1âˆ’ Ì„Î±
## âˆ’
## (  Ì„Î±)
## 1âˆ’Î²
## âˆ’
## 2Î³
## + (1âˆ’ Ì„Î±)
## 1âˆ’Î²
## âˆ’
## 2Î³
## âˆ’1
## (1âˆ’ Ì„Î±)
## 1âˆ’Î²
## âˆ’
## 2Î³
## âˆ’1
## (z
## ?
f
## )
## 1âˆ’Î²
## âˆ’
## 2Î³
## (
z
z
## ?
f
## )
## 1âˆ’Î²
## âˆ’
## 2Î³
## +K
## (  Ì„Î±)
## âˆ’âˆ’Î²
## âˆ’
## 2Î³
## + (1âˆ’ Ì„Î±)
## âˆ’âˆ’Î²
## âˆ’
## 2Î³
## âˆ’1
## (1âˆ’ Ì„Î±)
## âˆ’âˆ’Î²
## âˆ’
## 2Î³
## âˆ’1
## (z
## ?
f
## )
## âˆ’âˆ’Î²
## âˆ’
## 2Î³
## (
z
z
## ?
f
## )
## âˆ’âˆ’Î²
## âˆ’
## 2Î³
## =:k(
z
z
## ?
f
## ),(46)
wherek(u) is a polynomial inu:
k(u) =Au
n
## 1
+Bu
n
## 2
+Cu
n
## 3
## ,âˆ€uâˆˆ(0,1](47)
with
## 1
## 1âˆ’ Ì„Î±
## â‰¡n
## 1
>1> n
## 2
## â‰¡
## 1âˆ’Î²
## âˆ’
## 2Î³
> n
## 3
## â‰¡
## âˆ’âˆ’Î²
## âˆ’
## 2Î³
## >0,
## 23
Electronic copy available at: https://ssrn.com/abstract=2895437

and unambiguous definitions of the coefficientsA,B,andC.  We can show thatC >0.  In view of the fraction
insideC, we letg(x) =x
p
+p(1âˆ’x)âˆ’1 forp=
## âˆ’âˆ’Î²
## âˆ’
## 2Î³
âˆˆ(0,1).  Theng(1) = 0 andg
## â€²
## (x) =p(x
pâˆ’1
âˆ’1)>0 for
allxâˆˆ(0,1) sog(Â·) is strictly increasing over (0,1).  In particular,g(  Ì„Î±)< g(1) = 0.  Since the denominator
inCis also negative, we conclude thatC >0.
Also, observe thatk(0+) = 0 =H
## (1)
(0+).  Now, taking derivative ofk(u) in (47), we get
u
## 1âˆ’n
## 3
k
## â€²
(u) =An
## 1
u
n
## 1
## âˆ’n
## 3
+Bn
## 2
u
n
## 2
## âˆ’n
## 3
+Cn
## 3
## .(48)
From lim
uâ†“0
u
## 1âˆ’n
## 3
k
## â€²
(u) =Cn
## 3
>0 we know thatH
## (1),â€²
(z)>0 for sufficiently smallz >0.  Moreover,
u
## 2âˆ’n
## 3
k
## â€²â€²
(u) =An
## 1
## (n
## 1
## âˆ’1)u
n
## 1
## âˆ’n
## 3
+Bn
## 2
## (n
## 2
## âˆ’1)u
n
## 2
## âˆ’n
## 3
+Cn
## 3
## (n
## 3
## âˆ’1).(49)
Using standard argument by taking the derivative, it can be shown that functions like the right hand side
of  (49) can change monotonicity at most once over (0,1).  Clearly, the right hand side of  (49) converges to
## Cn
## 3
## (n
## 3
âˆ’1)<0 asuâ†“0.  On the other hand, becauseH
f
(z)âˆ’H(z) is convex over (Ïˆ
q
## (x
## 0
## ),Ïˆ
q
## (b
## ?
f
## )) (see
Lemma 4.3), we know that the right hand side of (49) is positive asuâ†‘1.  Given thatk(u) is maximized at
z
## ?
f
z
## ?
f
, we know thatk
## â€²â€²
(u) changes sign exactly once over (0,1).  More specifically, there areu
## 1
âˆˆ(0,1) such
thatk
## â€²â€²
(u)<0 for alluâˆˆ(0,u
## 1
), andk
## â€²â€²
(u)>0 for alluâˆˆ(u
## 1
,1).  This proves the pattern of convexity
change forH
## (1)
(Â·).  It follows thatH
## (1)
(Â·) is strictly increasing from 0 to
z
## ?
f
, in particular,H
## (1)
(z)>0 for
allzâˆˆ(0,z
## ?
f
).  Thus, the smallest nonnegative concave majorant ofH
## (1)
(Â·) is given by
## H
## (1)
## (zâˆ§
z
## ?
f
## ),
and the optimal stopping region for (24) is given byÏˆ
## âˆ’1
q
## ((0,
z
## ?
f
## ]) = (0,b
## ?
f
].  Finally, the global maximumz
## ?
f
is the unique solution to
k
## â€²
## (
z
z
## ?
f
## ) = 0,
z
## ?
f
z
## ?
f
## âˆˆ(0,u
## 1
## ).(50)
## References
Borodin, A. and Salminen, P. (2002).Handbook of Brownian Motion:  Facts and Formulae. Birkhauser, 2nd
edition.
Carr, P., Jarrow, R., and Myneni, R. (1992).  Alternative characterizations of American put options.Math-
ematical Finance, 2:87â€“105.
Cartea,  A.,  Jaimungal,  S.,  and Penalva,  J. (2015).Algorithmic  and  High-Frequency  Trading.  Cambridge
## University Press, Cambridge, England.
Dai, M., Zhang, Q., and Zhu, Q. (2010).  Trend following trading under a regime switching model.SIAM
Journal on Financial Mathematics, 1(1):780â€“810.
Dayanik,  S.  and  Karatzas,  I.  (2003).   On  the  optimal  stopping  problem  for  one-dimensional  diffusions.
Stochastic Processes and their Applications Appl., 107 (2):173â€“212.
## 24
Electronic copy available at: https://ssrn.com/abstract=2895437

Egami, M. and Oryu, T. (2017).  A direct solution method for pricing options involving maximum process.
Finance and Stochastics, forthcoming.
Glynn, P. and Iglehart, D. (1995). Trading securities using trailing stops.Management Science, 41:1096â€“1106.
Imkeller, N. and Rogers, L. (2014). Trading to stops.SIAM Journal on Financial Mathematics, 5(1):753â€“781.
Lehoczky, J. (1977).  Formulas for stopped diffusion processes with stopping times based on the maximum.
Annals of Probability, 5(4):601â€“607.
Leung,  T.  and  Li,  X.  (2015).   Optimal  mean  reversion  trading  with  trasaction  costs  and  stop-loss  exit.
International Journal of Theoretical and Applied Finance, 18(3):1550020.
Leung,  T.,  Li,  X.,  and Wang,  Z. (2014).  Optimal startingâ€“stopping and switching of a CIR process with
fixed costs.Risk and Decision Analysis, 5(2):149â€“161.
Leung, T., Li, X., and Wang, Z. (2015).  Optimal multiple trading times under the exponential OU model
with transaction costs.Stochastic Models, 31(4):554â€“587.
Leung,  T.  and  Ludkovski,  M.  (2011).   Optimal  timing  to  purchase  options.SIAM  Journal  on  Financial
## Mathematics, 2(1):768â€“793.
Leung, T. and Wang, Z. (2018). Optimal risk-averse timing of an asset sale:  trending versus mean-reverting
price dynamics.Annals of Finance.  Forthcoming.
Leung,  T.  and  Yamazaki,  K.  (2013).   American  step-up  and  step-down  credit  default  swaps  under  L Ìevy
models.Quantitative Finance, 13(1):137â€“157.
Rodosthenous,  N.  and  Zhang,  H.  (2017a).   Beating  the  Omega  clock:  an  optimal  stopping  problem  with
random time-horizon under spectrally negative L Ìevy models.  The Annals of Applied Probability, forth-
coming.
Rodosthenous, N. and Zhang, H. (2017b).  How to sell a stock amid anxiety about drawdowns - an optimal
stopping approach.  Working paper.
Salminen, P., Vallois, P., and Yor, M. (2007). On the excursion theory for linear diffusions.Japanese Journal
of Mathematics, 2(1):97â€“127.
Shepp, L. and Shiryaev, A. N. (1993).  The Russian option:  Reduced regret.Annals of Applied Probability,
## 3(3):603â€“631.
Temme, N. (2000). Numerical and asymptotic aspects of parabolic cylinder functions.Journal of Computa-
tional and Applied Mathematics, 121(1-2):221â€“246.
Warburton, A. and Zhang, Z. (2006). A simple computational model for analyzing the properties of stop-less,
take profit, and price breakout trading strategies.Computers and Operations Research, 33(1):32â€“42.
Yin, G., Zhang, Q., and Zhuang, C. (2010). Recursive algorithms for trailing stop:  stochastic approximation
approach.Journal of Optimization Theory and Applications, 146(1):209â€“231.
Zervos, M., Johnson, T., and Alazemi, F. (2013). Buy-low and sell-high investment strategies.Mathematical
## Finance, 23(3):560â€“578.
## 25
Electronic copy available at: https://ssrn.com/abstract=2895437

Zhang, H. (2015). Occupation time, drawdowns, and drawups for one-dimensional regular diffusion.Advances
in Applied Probability, 47(1):210â€“230.
Zhang, H. and Hadjiliadis, O. (2012). Drawdowns and the speed of market crash.Methodology and Computing
in Applied Probability, 14:739â€“752.
Zhang, H., Rodosthenous, N., and Hadjiliadis, O. (2015).  Robustness of the N-CUSUM stopping rule in a
Wiener disorder problem.The Annals of Applied Probability, 25(6):3405â€“3433.
Zhang,  H.  and  Zhang,  Q.  (2008).   Trading  a  mean-reverting  asset:  Buy  low  and  sell  high.Automatica,
## 44(6):1511â€“1518.
## 26
Electronic copy available at: https://ssrn.com/abstract=2895437